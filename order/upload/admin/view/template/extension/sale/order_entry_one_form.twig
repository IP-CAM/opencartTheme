{{ header }}{{ column_left }}
<div id="content">
	<div class="page-header">
		<div class="container-fluid">
			<div class="pull-right">
				<!--<button type="button" id="button-save" class="btn btn-primary"><i class="fa fa-check-circle"></i> {{ button_save }}</button>//-->
				<a onclick="cancel();" class="btn btn-default"><i class="fa fa-reply"></i> {{ button_cancel }}</a>
			</div>
			<h1>{{ heading_title }}</h1>
			<ul class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
					<li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
				{% endfor %}
			</ul>
		</div>
	</div>
	<style>
		#grey_screen {
			position:absolute;
			left:0;
			top:0;
			background:#000;
			z-index:998;
		}
	</style>
	<div id="grey_screen"></div>
	<div id="please_wait" style="display:none;position:fixed;top:50%;left:50%;width:300px;height:50px;margin-left:-150px;margin-top:-25px;padding-top:13px;border:1px solid #000;background-color:#FFF;border-radius:5px;font-size:14px;font-weight:bold;color:red;text-align:center;z-index:9999;">{{ text_please_wait }}</div>
	<div class="container-fluid">
		<div class="row" style="margin-bottom:13px;">
			<div class="col-md-4">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title"><i class="fa fa-user"></i> {{ text_order_detail }}</h3>
						<h3 id="edit-customer-info" class="panel-title" style="float:right;cursor:pointer;"><i class="fa fa-pencil"></i> </h3>
					</div>
					<div class="panel-body">
						<table class="table">
							<tbody>
								<tr>
									{% if order_quote == 'order' %}
										<td><b>{{ text_order_id }}</b></td>
										<td>
											{% if order_id %}
												{{ order_id }}
											{% else %}
												{{ new_order }}
											{% endif %}
										</td>
									{% else %}
										<td><b>{{ text_quote_id }}</b></td>
										<td>
											{% if quote_id %}
												{{ quote_id }}
											{% else %}
												{{ new_quote }}
											{% endif %}
										</td>
									{% endif %}
								</tr>
								<tr>
									<td><b>{{ text_customer_group }}</b></td>
									<td id="customer-group">{{ customer_group }}</b></td>
								</tr>
								<tr>
									<td><b>{{ text_customer }}</b></td>
									<td id="customer-name">{{ firstname }} {{ lastname }}</td>
								</tr>
								<tr>
									<td><b>{{ text_email }}</b></td>
									<td id="customer-email">{{ email }}</td>
								</tr>
								<tr>
									<td><b>{{ text_telephone }}</b></td>
									<td id="customer-telephone">{{ telephone }}</td>
								</tr>
								<tr id="new-customer" style="display:none;">
									<td class="text-right">
										{% if module_order_entry_save_new_customer %}
											<input type="checkbox" name="save_customer" value="1" checked="checked" /><br />
										{% else %}
											<input type="checkbox" name="save_customer" value="1" /><br />
										{% endif %}
										<input type="checkbox" name="notify_customer" value="1" />
									</td>
									<td><b>{{ text_save_customer }}</b><br /><b>{{ text_notify_customer }}</b></td>
								</tr>
								{% if order_id %}
									<tr>
										<td><b>{{ text_store }}</b></td>
										<td>
											{{ store_name }}
										</td>
									</tr>
									<tr>
										<td><b>{{ text_currency }}</b></td>
										<td>
											{{ currency_info }}
											<select name="currency" style="display:none;">
												<option value="{{ currency_code }}" selected="selected"></option>
											</select>
											<input type="hidden" name="currency_id" value="" />
										</td>
									</tr>
								{% else %}
									<tr>
										<td><b>{{ entry_store }}</b></td>
										<td>
											<select name="store_id" id="input-store" class="form-control">
												{% for store in stores %}
													{% if store.store_id == store_id %}
														<option value="{{ store.store_id }}" selected="selected">{{ store.name }}</option>
													{% else %}
														<option value="{{ store.store_id }}">{{ store.name }}</option>
													{% endif %}
												{% endfor %}
											</select>
										</td>
									</tr>
									<tr>
										<td><b>{{ entry_currency }}</b></td>
										<td>
											<select name="currency" id="input-currency" class="form-control">
												{% for currency in currencies %}
													{% if currency.code == currency_code %}
														<option value="{{ currency.code }}" selected="selected">{{ currency.title }}</option>
													{% else %}
														<option value="{{ currency.code }}">{{ currency.title }}</option>
													{% endif %}
												{% endfor %}
											</select>
											<input type="hidden" name="currency_id" value="" />
										</td>
									</tr>
								{% endif %}
								<tr>
									<td><b>{{ entry_language }}</b></td>
									<td>
										<select name="language" id="input-language" class="form-control">
											{% for language in languages %}
												{% if language.language_id == language_id %}
													<option value="{{ language.language_id }}" selected="selected">{{ language.name }}</option>
												{% else %}
													<option value="{{ language.language_id }}">{{ language.name }}</option>
												{% endif %}
											{% endfor %}
										</select>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title"><i class="fa fa-user"></i> {{ text_payment_address }}</h3>
						<h3 id="edit-customer-addr" class="panel-title" style="float:right;cursor:pointer;"><i class="fa fa-pencil"></i> </h3>
					</div>
					<div class="panel-body">
						<table class="table">
							<tbody>
								{% if customer_id %}
									<tr id="payment-address">
								{% else %}
									<tr id="payment-address" style="display:none;">
								{% endif %}
									<td><b>{{ entry_address }}</b></td>
									<td>
										<select name="payment_address" id="input-payment-address" class="form-control">
											<option value="0" selected="selected">{{ text_none }}</option>
											{% for address in addresses %}
												{% if address.city != '' %}
													<option value="{{ address.address_id }}">{{ address.firstname }} {{ address.lastname }}, {{ address.address_1 }}, {{ address.city }}, {{ address.country }}</option>
												{% else %}
													<option value="{{ address.address_id }}">{{ address.firstname }} {{ address.lastname }}, {{ address.address_1 }}, {{ address.country }}</option>
												{% endif %}
											{% endfor %}
										</select>
									</td>
								</tr>
								<tr id="pa-company-box">
									<td><b>{{ text_company }}</b></td>
									<td id="pa-company">{{ payment_company }}</b></td>
								</tr>
								<tr>
									<td><b>{{ text_name }}</b></td>
									<td id="pa-name">{{ payment_firstname }} {{ payment_lastname }}</td>
								</tr>
								<tr>
									<td><b>{{ text_address_1 }}</b></td>
									<td id="pa-address-1">{{ payment_address_1 }}</td>
								</tr>
								<tr id="pa-address-2-box">
									<td><b>{{ text_address_2 }}</b></td>
									<td id="pa-address-2">{{ payment_address_2 }}</td>
								</tr>
								<tr>
									<td><b>{{ text_address_3 }}</b></td>
									<td id="pa-address-3">
										{% if payment_city %}
											{{ payment_city }}, 
										{% endif %}
										{% if payment_zone and payment_zone != '--- Please Select ---' %}
											{{ payment_zone }},
										{% endif %}
										{% if payment_postcode %}
											{{ payment_postcode }}
										{% endif %}
									</td>
								</tr>
								<tr>
									<td><b>{{ text_country }}</b></td>
									<td id="pa-country">{{ payment_country }}</td>
								</tr>
								<tr>
									<td class="text-right"><input type="checkbox" name="shipping_same_payment" value="1" checked="checked" /></td>
									<td><b>{{ text_shipping_same_payment }}</b></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="col-md-4">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title"><i class="fa fa-user"></i> {{ text_shipping_address }}</h3>
						<h3 id="edit-customer-saddr" class="panel-title" style="display:none;float:right;cursor:pointer;"><i class="fa fa-pencil"></i> </h3>
					</div>
					<div class="panel-body">
						<table class="table">
							<tbody>
								<tr id="shipping-address" style="display:none;">
									<td><b>{{ entry_address }}</b></td>
									<td>
										<select name="shipping_address" id="input-shipping-address" class="form-control">
											<option value="0" selected="selected">{{ text_none }}</option>
											{% for address in addresses %}
												{% if address.city != '' %}
													<option value="{{ address.address_id }}">{{ address.firstname }} {{ address.lastname }}, {{ address.address_1 }}, {{ address.city }}, {{ address.country }}</option>
												{% else %}
													<option value="{{ address.address_id }}">{{ address.firstname }} {{ address.lastname }}, {{ address.address_1 }}, {{ address.country }}</option>
												{% endif %}
											{% endfor %}
										</select>
									</td>
								</tr>
								<tr id="sa-company-box">
									<td><b>{{ text_company }}</b></td>
									<td id="sa-company">{{ shipping_company }}</b></td>
								</tr>
								<tr>
									<td><b>{{ text_name }}</b></td>
									<td id="sa-name">{{ shipping_firstname }} {{ shipping_lastname }}</td>
								</tr>
								<tr>
									<td><b>{{ text_address_1 }}</b></td>
									<td id="sa-address-1">{{ shipping_address_1 }}</td>
								</tr>
								<tr id="sa-address-2-box">
									<td><b>{{ text_address_2 }}</b></td>
									<td id="sa-address-2">{{ shipping_address_2 }}</td>
								</tr>
								<tr>
									<td><b>{{ text_address_3 }}</b></td>
									<td id="sa-address-3">
										{% if shipping_city %}
											{{ shipping_city }},
										{% endif %}
										{% if shipping_zone and shipping_zone != '--- Please Select ---' %}
											{{ shipping_zone }},
										{% endif %}
										{% if shipping_postcode %}
											{{ shipping_postcode }}
										{% endif %}
									</td>
								</tr>
								<tr>
									<td><b>{{ text_country }}</b></td>
									<td id="sa-country">{{ shipping_country }}</td>
								</tr>
								<tr id="new-address" style="display:none;">
									<td class="text-right"><input type="checkbox" name="save_address" value="1" /></td>
									<td><b>{{ text_save_address }}</b></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>

		{% if show_previous_orders and order_quote == 'order' %}
			<div id="previous-orders" class="row" style="margin-bottom:13px;">
				<div class="col-md-12">
					<div class="panel panel-default">
						<div class="panel-heading">
							<h3 class="panel-title"><i class="fa fa-shopping-cart"></i> {{ text_previous_orders }}</h3>
						</div>
						<div class="panel-body">
							<div class="table-responsive">
								<table class="table table-bordered">
									<thead>
										<tr>
											<td class="text-left">{{ column_order_id }}</td>
											<td class="text-left">{{ column_order_date }}</td>
											<td class="text-left">{{ column_order_products }}</td>
											<td class="text-right">{{ column_order_total }}</td>
											<td class="text-left">{{ column_payment_method }}</td>
											<td class="text-left">{{ column_shipping_method }}</td>
											<td class="text-left">{{ column_order_status }}</td>
										</tr>
									</thead>
									<tbody id="previous-orders-table">
										<tr>
											<td class="text-center" colspan="7">{{ text_no_previous_orders }}</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		{% endif %}

		<!-- Begin Popups //-->
		<!-- Customer Information Popup //-->
		<div id="customer-information" style="display:none;position:fixed;top:0;left:50%;width:500px;margin-left:-250px;background-color:#F7F7F7;border:1px solid #000;border-radius:5px;z-index:99999;">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_order_detail }}</h3>
					<h3 id="close-customer-info" class="panel-title" style="float:right;cursor:pointer;">X</h3>
				</div>
				<div class="panel-body" style="height:516px !important;overflow:auto !important;">
					<form class="form-horizontal">
						<fieldset>
							<div class="form-group">
								<label class="col-sm-4 control-label" for="input-customer">{{ entry_customer }}</label>
								<div class="col-sm-8">
									<input type="text" name="customer" value="{{ customer }}" placeholder="{{ help_customer_autocomplete }}" id="input-customer" class="form-control" />
									<input type="hidden" name="customer_id" value="{{ customer_id }}" />
									<input type="hidden" name="store" value="{{ store_id }}" />
									<input type="hidden" name="store_id" value="{{ store_id }}" />
								</div>
							</div>
							<div class="form-group required">
								<label class="col-sm-4 control-label" for="input-customer-group">{{ entry_customer_group }}</label>
								<div class="col-sm-8">
									<select name="customer_group_id" id="input-customer-group" class="form-control">
										{% for customer_group in customer_groups %}
											{% if customer_group.customer_group_id == customer_group_id %}
												<option value="{{ customer_group.customer_group_id }}" selected="selected">{{ customer_group.name }}</option>
											{% elseif customer_group.customer_group_id == module_order_entry_customer_group %}
												<option value="{{ customer_group.customer_group_id }}" selected="selected">{{ customer_group.name }}</option>
											{% else %}
												<option value="{{ customer_group.customer_group_id }}">{{ customer_group.name }}</option>
											{% endif %}
										{% endfor %}
									</select>
								</div>
							</div>
							<div class="form-group required">
								<label class="col-sm-4 control-label" for="input-firstname">{{ entry_firstname }}</label>
								<div class="col-sm-8">
									<input type="text" name="firstname" id="input-firstname" value="{{ firstname }}" class="form-control" />
								</div>
							</div>
							{% if module_order_entry_require_lastname %}
								<div class="form-group required">
							{% else %}
								<div class="form-group">
							{% endif %}
								<label class="col-sm-4 control-label" for="input-lastname">{{ entry_lastname }}</label>
								<div class="col-sm-8">
									<input type="text" name="lastname" id="input-lastname" value="{{ lastname }}" class="form-control" />
								</div>
							</div>
							{% if module_order_entry_require_email %}
								<div class="form-group required">
							{% else %}
								<div class="form-group">
							{% endif %}
								<label class="col-sm-4 control-label" for="input-email">{{ entry_email }}</label>
								<div class="col-sm-8">
									<input type="text" name="email" id="input-email" value="{{ email }}" class="form-control" />
								</div>
							</div>
							{% if module_order_entry_require_telephone %}
								<div class="form-group required">
							{% else %}
								<div class="form-group">
							{% endif %}
								<label class="col-sm-4 control-label" for="input-telephone">{{ entry_telephone }}</label>
								<div class="col-sm-8">
									<input type="text" name="telephone" id="input-telephone" value="{{ telephone }}" class="form-control" />
								</div>
							</div>
							{% for custom_field in custom_fields %}
								{% if custom_field.location == 'account' %}
									{% if custom_field.type == 'select' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<select name="custom_field[{{ custom_field.custom_field_id }}]" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control">
													<option value="">{{ text_select }}</option>
													{% for custom_field_value in custom_field.custom_field_value %}
														{% if account_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id == account_custom_field[custom_field.custom_field_id] %}
															<option value="{{ custom_field_value.custom_field_value_id }}" selected="selected">{{ custom_field_value.name }}</option>
														{% else %}
															<option value="{{ custom_field_value.custom_field_value_id }}">{{ custom_field_value.name }}</option>
														{% endif %}
													{% endfor %}
												</select>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'radio' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div id="input-custom-field{{ custom_field.custom_field_id }}">
													{% for custom_field_value in custom_field.custom_field_value %}
														<div class="radio">
															{% if account_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id == account_custom_field[custom_field.custom_field_id] %}
																<label>
																	<input type="radio" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ custom_field_value.custom_field_value_id }}" checked="checked" />
																	{{ custom_field_value.name }}
																</label>
															{% else %}
																<label>
																	<input type="radio" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ custom_field_value.custom_field_value_id }}" />
																	{{ custom_field_value.name }}
																</label>
															{% endif %}
														</div>
													{% endfor %}
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'checkbox' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div id="input-custom-field{{ custom_field.custom_field_id }}">
													{% for custom_field_value in custom_field.custom_field_value %}
														<div class="checkbox">
															{% if account_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id in account_custom_field[custom_field.custom_field_id] %}
																<label>
																	<input type="checkbox" name="custom_field[{{ custom_field.custom_field_id }}][]" value="{{ custom_field_value.custom_field_value_id }}" checked="checked" />
																	{{ custom_field_value.name }}
																</label>
															{% else %}
																<label>
																	<input type="checkbox" name="custom_field[{{ custom_field.custom_field_id }}][]" value="{{ custom_field_value.custom_field_value_id }}" />
																	{{ custom_field_value.name }}
																</label>
															{% endif %}
														</div>
													{% endfor %}
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'text' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ account_custom_field[custom_field.custom_field_id] ? account_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'textarea' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<textarea name="custom_field[{{ custom_field.custom_field_id }}]" rows="5" placeholder="{{ custom_field.name }}" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control">{{ custom_field.value }}</textarea>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'file' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<button type="button" id="button-custom-field{{ custom_field.custom_field_id }}" class="btn btn-default"><i class="fa fa-upload"></i> {{ button_upload }}</button>
												<input type="hidden" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ account_custom_field[custom_field.custom_field_id] ? account_custom_field[custom_field.custom_field_id] }}" id="input-custom-field{{ custom_field.custom_field_id }}" />
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'date' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div class="input-group date">
													<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ account_custom_field[custom_field.custom_field_id] ? account_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" data-date-format="YYYY-MM-DD" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
													<span class="input-group-btn">
														<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'time' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div class="input-group time">
													<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ account_custom_field[custom_field.custom_field_id] ? account_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" data-date-format="HH:mm" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
													<span class="input-group-btn">
														<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'datetime' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div class="input-group datetime">
													<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ account_custom_field[custom_field.custom_field_id] ? account_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" data-date-format="YYYY-MM-DD HH:mm" id="input-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
													<span class="input-group-btn">
														<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
											</div>
										</div>
									{% endif %}
								{% endif %}
							{% endfor %}
						</fieldset>
					</form>
				</div>
				<div class="text-center" style="margin-bottom:13px;">
					<button type="button" id="button-customer-info" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-close"></i> {{ button_save }}</button>
					<button type="button" id="close-customer-info1" data-loading-text="{{ text_loading }}" class="btn btn-default"><i class="fa fa-reply"></i> {{ button_cancel }}</a>
					<button id="button-customer" style="display:none;"></button>
				</div>
			</div>
		</div>

		<!-- Customer Payment Address Popup //-->
		<div id="customer-address" style="display:none;position:fixed;top:0;left:50%;width:600px;margin-left:-300px;background-color:#F7F7F7;border:1px solid #000;border-radius:5px;z-index:99999;">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_payment_address }}</h3>
					<h3 id="close-customer-addr" class="panel-title" style="float:right;cursor:pointer;">X</h3>
				</div>
				<div class="panel-body" style="height:550px !important;overflow:auto !important;">
					<form class="form-horizontal">
						<fieldset>
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-payment-company">{{ entry_company }}</label>
								<div class="col-sm-9">
									<input type="text" name="company" id="input-payment-company" value="{{ payment_company }}" class="form-control" />
								</div>
							</div>
							<div class="form-group required">
								<label class="col-sm-3 control-label" for="input-payment-firstname">{{ entry_firstname }}</label>
								<div class="col-sm-9">
									<input type="text" name="firstname" id="input-payment-firstname" value="{{ payment_firstname }}" class="form-control" />
								</div>
							</div>
							{% if module_order_entry_require_lastname %}
								<div class="form-group required">
							{% else %}
								<div class="form-group">
							{% endif %}
								<label class="col-sm-3 control-label" for="input-payment-lastname">{{ entry_lastname }}</label>
								<div class="col-sm-9">
									<input type="text" name="lastname" id="input-payment-lastname" value="{{ payment_lastname }}" class="form-control" />
								</div>
							</div>
							<div class="form-group required">
								<label class="col-sm-3 control-label" for="input-payment-address-1">{{ entry_address_1 }}</label>
								<div class="col-sm-9">
									<input type="text" name="address_1" id="input-payment-address-1" value="{{ payment_address_1 }}" class="form-control" />
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-payment-address-2">{{ entry_address_2 }}</label>
								<div class="col-sm-9">
									<input type="text" name="address_2" id="input-payment-address-2" value="{{ payment_address_2 }}" class="form-control" />
								</div>
							</div>
							{% if module_order_entry_require_city %}
								<div class="form-group required">
							{% else %}
								<div class="form-group">
							{% endif %}
								<label class="col-sm-3 control-label" for="input-payment-city">{{ entry_city }}</label>
								<div class="col-sm-9">
									<input type="text" name="city" id="input-payment-city" value="{{ payment_city }}" class="form-control" />
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-payment-postcode">{{ entry_postcode }}</label>
								<div class="col-sm-9">
									<input type="text" name="postcode" id="input-payment-postcode" value="{{ payment_postcode }}" class="form-control" />
								</div>
							</div>
							<div class="form-group required">
								<label class="col-sm-3 control-label" for="input-payment-country">{{ entry_country }}</label>
								<div class="col-sm-9">
									<select name="country_id" id="input-payment-country" class="form-control">
										{% for country in countries %}
											{% if country.country_id == payment_country_id %}
												<option value="{{ country.country_id }}" selected="selected">{{ country.name }}</option>
											{% else %}
												<option value="{{ country.country_id }}">{{ country.name }}</option>
											{% endif %}
										{% endfor %}
									</select>
									<input type="hidden" name="country" value="" />
								</div>
							</div>
							{% if module_order_entry_require_zone %}
								<div class="form-group required">
							{% else %}
								<div class="form-group">
							{% endif %}
								<label class="col-sm-3 control-label" for="input-payment-zone">{{ entry_zone }}</label>
								<div class="col-sm-9">
									<select name="zone_id" id="input-payment-zone" class="form-control">
									</select>
									<input type="hidden" name="zone" value="" />
									<input type="hidden" name="zone_code" value="" />
								</div>
							</div>
							{% for custom_field in custom_fields %}
								{% if custom_field.location == 'address' %}
									{% if custom_field.type == 'select' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-payment-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<select name="custom_field[{{ custom_field.custom_field_id }}]" id="input-payment-custom-field{{ custom_field.custom_field_id }}" class="form-control">
													<option value="">{{ text_select }}</option>
													{% for custom_field_value in custom_field.custom_field_value %}
														{% if payment_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id == payment_custom_field[custom_field.custom_field_id] %}
															<option value="{{ custom_field_value.custom_field_value_id }}" selected="selected">{{ custom_field_value.name }}</option>
														{% else %}
															<option value="{{ custom_field_value.custom_field_value_id }}">{{ custom_field_value.name }}</option>
														{% endif %}
													{% endfor %}
												</select>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'radio' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div id="input-payment-custom-field{{ custom_field.custom_field_id }}">
													{% for custom_field_value in custom_field.custom_field_value %}
														<div class="radio">
															{% if payment_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id == payment_custom_field[custom_field.custom_field_id] %}
																<label>
																	<input type="radio" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ custom_field_value.custom_field_value_id }}" checked="checked" />
																	{{ custom_field_value.name }}
																</label>
															{% else %}
																<label>
																	<input type="radio" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ custom_field_value.custom_field_value_id }}" />
																	{{ custom_field_value.name }}
																</label>
															{% endif %}
														</div>
													{% endfor %}
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'checkbox' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div id="input-payment-custom-field{{ custom_field.custom_field_id }}">
													{% for custom_field_value in custom_field.custom_field_value %}
														<div class="checkbox">
															{% if payment_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id in payment_custom_field[custom_field.custom_field_id] %}
																<label>
																	<input type="checkbox" name="custom_field[{{ custom_field.custom_field_id }}][]" value="{{ custom_field_value.custom_field_value_id }}" checked="checked" />
																	{{ custom_field_value.name }}
																</label>
															{% else %}
																<label>
																	<input type="checkbox" name="custom_field[{{ custom_field.custom_field_id }}][]" value="{{ custom_field_value.custom_field_value_id }}" />
																	{{ custom_field_value.name }}
																</label>
															{% endif %}
														</div>
													{% endfor %}
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'text' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-payment-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ payment_custom_field[custom_field.custom_field_id] ? payment_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" id="input-payment-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'textarea' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-payment-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<textarea name="custom_field[{{ custom_field.custom_field_id }}]" rows="5" placeholder="{{ custom_field.name }}" id="input-payment-custom-field{{ custom_field.custom_field_id }}" class="form-control">{{ payment_custom_field[custom_field.custom_field_id] ? payment_custom_field[custom_field.custom_field_id] : custom_field.value }}</textarea>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'file' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<button type="button" id="button-payment-custom-field{{ custom_field.custom_field_id }}" data-loading-text="{{ text_loading }}" class="btn btn-default"><i class="fa fa-upload"></i> {{ button_upload }}</button>
												<input type="hidden" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ payment_custom_field[custom_field.custom_field_id] ? payment_custom_field[custom_field.custom_field_id] }}" id="input-payment-custom-field{{ custom_field.custom_field_id }}" />
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'date' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-payment-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div class="input-group date">
													<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ payment_custom_field[custom_field.custom_field_id] ? payment_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" data-date-format="YYYY-MM-DD" id="input-payment-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
													<span class="input-group-btn">
														<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'time' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-payment-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div class="input-group time">
													<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ payment_custom_field[custom_field.custom_field_id] ? payment_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" data-date-format="HH:mm" id="input-payment-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
													<span class="input-group-btn">
														<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'datetime' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-payment-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div class="input-group datetime">
													<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ payment_custom_field[custom_field.custom_field_id] ? payment_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" data-date-format="YYYY-MM-DD HH:mm" id="input-payment-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
													<span class="input-group-btn">
														<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
											</div>
										</div>
									{% endif %}
								{% endif %}
							{% endfor %}
						</fieldset>
					</form>
				</div>
				<div class="text-center" style="margin-bottom:13px;">
					<button type="button" id="button-save-customer-addr" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-close"></i> {{ button_save }}</button>
					<button type="button" id="close-customer-addr1" data-loading-text="{{ text_loading }}" class="btn btn-default"><i class="fa fa-reply"></i> {{ button_cancel }}</a>
					<button id="button-payment-address" style="display:none;"></button>
				</div>
			</div>
		</div>

		<!-- Customer Shipping Address Popup //-->
		<div id="customer-saddress" style="display:none;position:fixed;top:0;left:50%;width:600px;margin-left:-300px;background-color:#F7F7F7;border:1px solid #000;border-radius:5px;z-index:99999;">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_shipping_address }}</h3>
					<h3 id="close-customer-saddr" class="panel-title" style="float:right;cursor:pointer;">X</h3>
				</div>
				<div class="panel-body" style="height:550px !important;overflow:auto !important;">
					<form class="form-horizontal">
						<fieldset>
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-shipping-company">{{ entry_company }}</label>
								<div class="col-sm-9">
									<input type="text" name="company" id="input-shipping-company" value="{{ shipping_company }}" class="form-control" />
								</div>
							</div>
							<div class="form-group required">
								<label class="col-sm-3 control-label" for="input-shipping-firstname">{{ entry_firstname }}</label>
								<div class="col-sm-9">
									<input type="text" name="firstname" id="input-shipping-firstname" value="{{ shipping_firstname }}" class="form-control" />
								</div>
							</div>
							{% if module_order_entry_require_lastname %}
								<div class="form-group required">
							{% else %}
								<div class="form-group">
							{% endif %}
								<label class="col-sm-3 control-label" for="input-shipping-lastname">{{ entry_lastname }}</label>
								<div class="col-sm-9">
									<input type="text" name="lastname" id="input-shipping-lastname" value="{{ shipping_lastname }}" class="form-control" />
								</div>
							</div>
							<div class="form-group required">
								<label class="col-sm-3 control-label" for="input-shipping-address-1">{{ entry_address_1 }}</label>
								<div class="col-sm-9">
									<input type="text" name="address_1" id="input-shipping-address-1" value="{{ shipping_address_1 }}" class="form-control" />
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-shipping-address-2">{{ entry_address_2 }}</label>
								<div class="col-sm-9">
									<input type="text" name="address_2" id="input-shipping-address-2" value="{{ shipping_address_2 }}" class="form-control" />
								</div>
							</div>
							{% if module_order_entry_require_city %}
								<div class="form-group required">
							{% else %}
								<div class="form-group">
							{% endif %}
								<label class="col-sm-3 control-label" for="input-shipping-city">{{ entry_city }}</label>
								<div class="col-sm-9">
									<input type="text" name="city" id="input-shipping-city" value="{{ shipping_city }}" class="form-control" />
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-shipping-postcode">{{ entry_postcode }}</label>
								<div class="col-sm-9">
									<input type="text" name="postcode" id="input-shipping-postcode" value="{{ shipping_postcode }}" class="form-control" />
								</div>
							</div>
							<div class="form-group required">
								<label class="col-sm-3 control-label" for="input-shipping-country">{{ entry_country }}</label>
								<div class="col-sm-9">
									<select name="country_id" id="input-shipping-country" class="form-control">
										{% for country in countries %}
											{% if country.country_id == shipping_country_id %}
												<option value="{{ country.country_id }}" selected="selected">{{ country.name }}</option>
											{% else %}
												<option value="{{ country.country_id }}">{{ country.name }}</option>
											{% endif %}
										{% endfor %}
									</select>
									<input type="hidden" name="country" value="" />
								</div>
							</div>
							{% if module_order_entry_require_zone %}
								<div class="form-group required">
							{% else %}
								<div class="form-group">
							{% endif %}
								<label class="col-sm-3 control-label" for="input-shipping-zone">{{ entry_zone }}</label>
								<div class="col-sm-9">
									<select name="zone_id" id="input-shipping-zone" class="form-control">
									</select>
									<input type="hidden" name="zone" value="" />
									<input type="hidden" name="zone_code" value="" />
								</div>
							</div>
							{% for custom_field in custom_fields %}
								{% if custom_field.location == 'address' %}
									{% if custom_field.type == 'select' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-shipping-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<select name="custom_field[{{ custom_field.custom_field_id }}]" id="input-shipping-custom-field{{ custom_field.custom_field_id }}" class="form-control">
													<option value="">{{ text_select }}</option>
													{% for custom_field_value in custom_field.custom_field_value %}
														{% if shipping_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id == shipping_custom_field[custom_field.custom_field_id] %}
															<option value="{{ custom_field_value.custom_field_value_id }}" selected="selected">{{ custom_field_value.name }}</option>
														{% else %}
															<option value="{{ custom_field_value.custom_field_value_id }}">{{ custom_field_value.name }}</option>
														{% endif %}
													{% endfor %}
												</select>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'radio' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div id="input-shipping-custom-field{{ custom_field.custom_field_id }}">
													{% for custom_field_value in custom_field.custom_field_value %}
														<div class="radio">
															{% if shipping_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id == shipping_custom_field[custom_field.custom_field_id] %}
																<label>
																	<input type="radio" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ custom_field_value.custom_field_value_id }}" checked="checked" />
																	{{ custom_field_value.name }}
																</label>
															{% else %}
																<label>
																	<input type="radio" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ custom_field_value.custom_field_value_id }}" />
																	{{ custom_field_value.name }}
																</label>
															{% endif %}
														</div>
													{% endfor %}
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'checkbox' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div id="input-shipping-custom-field{{ custom_field.custom_field_id }}">
													{% for custom_field_value in custom_field.custom_field_value %}
														<div class="checkbox">
															{% if shipping_custom_field[custom_field.custom_field_id] and custom_field_value.custom_field_value_id in shipping_custom_field[custom_field.custom_field_id] %}
																<label>
																	<input type="checkbox" name="custom_field[{{ custom_field.custom_field_id }}][]" value="{{ custom_field_value.custom_field_value_id }}" checked="checked" />
																	{{ custom_field_value.name }}
																</label>
															{% else %}
																<label>
																	<input type="checkbox" name="custom_field[{{ custom_field.custom_field_id }}][]" value="{{ custom_field_value.custom_field_value_id }}" />
																	{{ custom_field_value.name }}
																</label>
															{% endif %}
														</div>
													{% endfor %}
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'text' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-shipping-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ shipping_custom_field[custom_field.custom_field_id] ? shipping_custom_field[custom_field.custom_field_id] ? custom_field.value }}" placeholder="{{ custom_field.name }}" id="input-shipping-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'textarea' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-shipping-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<textarea name="custom_field[{{ custom_field.custom_field_id }}]" rows="5" placeholder="{{ custom_field.name }}" id="input-shipping-custom-field{{ custom_field.custom_field_id }}" class="form-control">{{ shipping_custom_field[custom_field.custom_field_id] ? shipping_custom_field[custom_field.custom_field_id] : custom_field.value }}</textarea>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'file' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<button type="button" id="button-shipping-custom-field{{ custom_field.custom_field_id }}" data-loading-text="{{ text_loading }}" class="btn btn-default"><i class="fa fa-upload"></i> {{ button_upload }}</button>
												<input type="hidden" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ shipping_custom_field[custom_field.custom_field_id] ? shipping_custom_field[custom_field.custom_field_id] }}" id="input-custom-field{{ custom_field.custom_field_id }}" />
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'date' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-shipping-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div class="input-group date">
													<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ shipping_custom_field[custom_field.custom_field_id] ? shipping_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" data-date-format="YYYY-MM-DD" id="input-shipping-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
													<span class="input-group-btn">
														<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'time' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-shipping-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div class="input-group time">
													<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ shipping_custom_field[custom_field.custom_field_id] ? shipping_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" data-date-format="HH:mm" id="input-shipping-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
													<span class="input-group-btn">
														<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
											</div>
										</div>
									{% endif %}
									{% if custom_field.type == 'datetime' %}
										<div class="form-group custom-field custom-field{{ custom_field.custom_field_id }}" data-sort="{{ custom_field.sort_order + 3 }}">
											<label class="col-sm-2 control-label" for="input-shipping-custom-field{{ custom_field.custom_field_id }}">{{ custom_field.name }}</label>
											<div class="col-sm-10">
												<div class="input-group datetime">
													<input type="text" name="custom_field[{{ custom_field.custom_field_id }}]" value="{{ shipping_custom_field[custom_field.custom_field_id] ? shipping_custom_field[custom_field.custom_field_id] : custom_field.value }}" placeholder="{{ custom_field.name }}" data-date-format="YYYY-MM-DD HH:mm" id="input-shipping-custom-field{{ custom_field.custom_field_id }}" class="form-control" />
													<span class="input-group-btn">
														<button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button>
													</span>
												</div>
											</div>
										</div>
									{% endif %}
								{% endif %}
							{% endfor %}
						</fieldset>
					</form>
				</div>
				<div class="text-center" style="margin-bottom:13px;">
					<button type="button" id="button-save-customer-saddr" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-close"></i> {{ button_save }}</button>
					<button type="button" id="close-customer-saddr1" data-loading-text="{{ text_loading }}" class="btn btn-default"><i class="fa fa-reply"></i> {{ button_cancel }}</a>
					<button id="button-shipping-address" style="display:none;"></button>
				</div>
			</div>
		</div>

		<!-- Add product to order popup //-->
		<div id="add-product" style="display:none;position:fixed;top:0;left:50%;width:800px;min-height:280px;margin-left:-400px;background-color:#F7F7F7;border:1px solid #000;border-radius:5px;z-index:99999;">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_add_product }}</h3>
					<h3 id="close-add-product" class="panel-title" style="float:right;cursor:pointer;">X</h3>
				</div>
				<div id="add-product-error" style="display:none;"></div>
				<div class="panel-body">
					<form>
						<div id="tab-product">
							<div class="table table-responsive">
								<table class="table">
									<tbody>
										<tr>
											<td>{{ entry_product }}</td>
											<td colspan="3"><input type="text" name="product" value="" id="input-product" placeholder="{{ help_product_autocomplete }}" class="form-control" /><input type="hidden" name="product_id" value="" /></td>
										</tr>
										<tr>
											<td>{{ entry_custom_price }}</td>
											<td>
												<div class="checkbox">
													<label>
														<input type="checkbox" name="custom_price" value="1" />
													</label>
												</div>
											</td>
											<td>{{ entry_price }}</td>
											<td><input type="text" name="price" value="" id="input-price" class="form-control" disabled="disabled" /></td>
										</tr>
										<tr>
											<td>{{ entry_notax }}</td>
											<td>
												<div class="checkbox">
													<label>
														<input type="checkbox" name="notax" value="1" />
													</label>
												</div>
											</td>
											<td>{{ entry_quantity }}</td>
											<td><input type="text" name="quantity" value="1" id="input-quantity" class="form-control" /></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</form>
				</div>
				<div class="text-center" style="margin-bottom:13px;">
					<button type="button" id="button-product-add-more" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i> {{ button_product_add_more }}</button>
					<button type="button" id="button-product-add-close" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i> {{ button_product_add_close }}</button>
					<button type="button" id="close-add-product1" data-loading-text="{{ text_loading }}" class="btn btn-default"><i class="fa fa-reply"></i> {{ button_cancel }}</a>
				</div>
			</div>
		</div>

		<!-- Option box popup //-->
		<div id="option-box" style="display:none;position:fixed;top:0;left:50%;width:900px;height:600px;margin-left:-450px;background-color:#F7F7F7;border:1px solid #000;border-radius:5px;z-index:99999;overflow:auto;">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ entry_option }}</h3>
				</div>
				<div class="panel-body">
					<form class="form-horizontal">
						<div id="option"></div>
					</form>
				</div>
				<div class="text-center" style="margin-bottom:13px;">
					<button type="button" id="button-save-option" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i> {{ button_save }}</button>
					<button type="button" id="button-close-option" class="btn btn-default"><i class="fa fa-reply"></i></button>
				</div>
			</div>
		</div>

		<!-- Add voucher to order popup //-->
		<div id="add-voucher" style="display:none;position:fixed;top:0;left:50%;width:500px;min-height:516px;margin-left:-250px;background-color:#F7F7F7;border:1px solid #000;border-radius:5px;z-index:99999;">
			<div class="panel panel-default">
				<div class="panel-heading">
					<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_add_voucher }}</h3>
					<h3 id="close-add-voucher" class="panel-title" style="float:right;cursor:pointer;">X</h3>
				</div>
				<div class="panel-body">
					<form class="form-horizontal">
						<div id="tab-voucher">
							<fieldset>
								<div class="form-group required">
									<label class="col-sm-2 control-label" for="input-to-name">{{ entry_to_name }}</label>
									<div class="col-sm-10">
										<input type="text" name="to_name" value="" id="input-to-name" class="form-control" />
									</div>
								</div>
								<div class="form-group required">
									<label class="col-sm-2 control-label" for="input-to-email">{{ entry_to_email }}</label>
									<div class="col-sm-10">
										<input type="text" name="to_email" value="" id="input-to-email" class="form-control" />
									</div>
								</div>
								<div class="form-group required">
									<label class="col-sm-2 control-label" for="input-from-name">{{ entry_from_name }}</label>
									<div class="col-sm-10">
										<input type="text" name="from_name" value="" id="input-from-name" class="form-control" />
									</div>
								</div>
								<div class="form-group required">
									<label class="col-sm-2 control-label" for="input-from-email">{{ entry_from_email }}</label>
									<div class="col-sm-10">
										<input type="text" name="from_email" value="" id="input-from-email" class="form-control" />
									</div>
								</div>
								<div class="form-group required">
									<label class="col-sm-2 control-label" for="input-theme">{{ entry_theme }}</label>
									<div class="col-sm-10">
										<select name="voucher_theme_id" id="input-theme" class="form-control">
											{% for voucher_theme in voucher_themes %}
												<option value="{{ voucher_theme.voucher_theme_id }}">{{ voucher_theme.name }}</option>
											{% endfor %}
										</select>
									</div>
								</div>
								<div class="form-group">
									<label class="col-sm-2 control-label" for="input-message">{{ entry_message }}</label>
									<div class="col-sm-10">
										<textarea name="message" rows="5" id="input-message" class="form-control"></textarea>
									</div>
								</div>
								<div class="form-group required">
									<label class="col-sm-2 control-label" for="input-amount">{{ entry_amount }}</label>
									<div class="col-sm-10">
										<input type="text" name="amount" value="{{ voucher_min }}" id="input-amount" class="form-control" />
									</div>
								</div>
							</fieldset>
						</div>
					</form>
				</div>
				<div class="text-center" style="margin-bottom:13px;">
					<button type="button" id="button-voucher-add" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i> {{ button_voucher_add }}</button>
					<button type="button" id="close-add-voucher1" data-loading-text="{{ text_loading }}" class="btn btn-default"><i class="fa fa-reply"></i> {{ button_cancel }}</a>
				</div>
			</div>
		</div>
		<!-- End Popups //-->

		<div class="row" id="tab-cart" style="margin-bottom:13px;">
			<div class="col-md-12">
				<div class="panel panel-default">
					<div class="panel-heading">
						<h3 class="panel-title"><i class="fa fa-shopping-cart"></i> {{ text_products }}</h3>
					</div>
					<div class="panel-body">
						<form class="form-horizontal">
							<div class="table-responsive">
								<table class="table table-bordered">
									<thead>
										<tr>
											{% set columns = 5 %}
											{% if product_column_image %}
												<td class="text-center">{{ column_image }}</td>
												{% set columns = columns + 1 %}
											{% endif %}
											<td class="text-left" style="width:200px !important;">{{ column_product }}</td>
											{% if product_column_option %}
												<td class="text-left">{{ column_option }}</td>
												{% set columns = columns + 1 %}
											{% endif %}
											<td class="text-left">{{ column_model }}</td>
											<td class="text-right">{{ column_quantity }}</td>
											{% if product_column_price %}
												<td class="text-right">{{ column_price }}</td>
												{% set columns = columns + 1 %}
											{% endif %}
											{% if product_column_total %}
												<td class="text-right">{{ column_total }}</td>
												{% set columns = columns + 1 %}
											{% endif %}
											{% if product_column_cost %}
												<td class="text-right">{{ column_cost }}</td>
												{% set columns = columns + 1 %}
											{% endif %}
											{% if product_column_notax %}
												<td class="text-center" style="width:10px;">{{ column_notax }}</td>
												{% set columns = columns + 1 %}
											{% endif %}
											{% if product_column_pricet %}
												<td class="text-right">{{ column_price_t }}</td>
												{% set columns = columns + 1 %}
											{% endif %}
											{% if product_column_totalt %}
												<td class="text-right">{{ column_total_t }}</td>
												{% set columns = columns + 1 %}
											{% endif %}
											<td class="text-left">{{ column_sort_order }}</td>
											<td class="text-center">{{ column_action }}</td>
										</tr>
									</thead>
									<tbody id="cart">
										{% if order_products or order_vouchers %}
											{% set product_row = 0 %}
											{% for order_product in order_products %}
												<tr>
													{% if product_column_image %}
														<td class="text-center">
															<a id="thumb-image{{ product_row }}" data-toggle="image" class="img-thumbnail"><img src="{{ order_product.thumb }}" alt="" title="" data-placeholder="{{ placeholder }}" /></a>
															<input type="hidden" name="product[{{ product_row }}][image]" value="{{ order_product.image }}" id="input-image-{{ product_row }}" />
														</td>
													{% else %}
														<input type="hidden" name="product[{{ product_row }}][image]" value="" />
													{% endif %}
													<td class="text-left">
														<input id="name-{{ product_row }}" type="text" name="product[{{ product_row }}][name]" value="{{ order_product.name }}" class="form-control" />
														<input id="product-{{ product_row }}" type="hidden" name="product[{{ product_row }}][product_id]" value="{{ order_product.product_id }}" />
													</td>
													{% if product_column_option %}
														<td class="text-left">
															{% for option in order_product.option %}
																- <small>{{ option.name }}: {{ option.value }}</small><br />
																{% if option.type == 'select' or option.type == 'radio' or option.type == 'image' %}
																	<input type="hidden" name="product[{{ product_row }}][option][{{ option.product_option_id }}]" value="{{ option.product_option_value_id }}" />
																{% endif %}
																{% if option.type == 'checkbox' %}
																	<input type="hidden" name="product[{{ product_row }}][option][{{ option.product_option_id }}][]" value="{{ option.product_option_value_id }}" />
																{% endif %}
																{% if option.type == 'text' or option.type == 'textarea' or option.type == 'file' or option.type == 'date' or option.type == 'datetime' or option.type == 'time' %}
																	<input type="hidden" name="product[{{ product_row }}][option][{{ option.product_option_id }}]" value="{{ option.value }}" />
																{% endif %}
															{% endfor %}
														</td>
													{% else %}
														{% for option in order_product.option %}
															{% if option.type == 'select' or option.type == 'color' or option.type == 'radio' or option.type == 'image' %}
																<input type="hidden" name="product[{{ product_row }}][option][{{ option.product_option_id }}]" value="{{ option.product_option_value_id }}" />
															{% endif %}
															{% if option.type == 'checkbox' %}
																<input type="hidden" name="product[{{ product_row }}][option][{{ option.product_option_id }}][]" value="{{ option.product_option_value_id }}" />
															{% endif %}
															{% if option.type == 'text' or option.type == 'textarea' or option.type == 'file' or option.type == 'date' or option.type == 'datetime' or option.type == 'time' %}
																<input type="hidden" name="product[{{ product_row }}][option][{{ option.product_option_id }}]" value="{{ option.value }}" />
															{% endif %}
														{% endfor %}
													{% endif %}
													<td class="text-left">
														<input id="model-{{ product_row }}" type="text" name="product[{{ product_row }}][model]" value="{{ order_product.model }}" class="form-control" />
													</td>
													<input id="shipping-{{ product_row }}" type="hidden" name="product[{{ product_row }}][shipping]" value="{{ order_product.shipping }}" />
													<td class="text-right">
														<input id="quantity-{{ product_row }}" style="text-align:right;" type="text" name="product[{{ product_row }}][quantity]" value="{{ order_product.quantity }}" class="form-control" style="width:50px !important;" />
													</td>
													{% if product_column_price %}
														<td class="text-right">
															<input id="price-{{ product_row }}" style="text-align:right;" type="text" name="product[{{ product_row }}][price]" value="{{ order_product.price }}" class="form-control" />
														</td>
													{% else %}
														<input id="price-{{ product_row }}" type="hidden" name="product[{{ product_row }}][price]" value="{{ order_product.price }}" />
													{% endif %}
													{% if product_column_total %}
														<td class="text-right"></td>
													{% endif %}
													{% if product_column_cost %}
														<td class="text-right">{{ order_product.cost }}</td>
													{% endif %}
													{% if product_column_notax %}
														<td class="text-center">
															{% if order_product.notax %}
																<input id="notax-{{ product_row }}" type="checkbox" name="product[{{ product_row }}][notax]" value="1" checked="checked" />
															{% else %}
																<input id="notax-{{ product_row }}" type="checkbox" name="product[{{ product_row }}][notax]" value="1" />
															{% endif %}
														</td>
													{% else %}
														<input id="notax-{{ product_row }}" type="hidden" name="product[{{ product_row }}][notax]" value="{{ order_product.notax }}" />
													{% endif %}
													{% if product_column_pricet %}
														<td class="text-right"></td>
													{% endif %}
													{% if product_column_totalt %}
														<td class="text-right"></td>
													{% endif %}
													<td class="text-left"><input id="sort-order-{{ product_row }}" type="text" name="product[{{ product_row }}][sort_order]" value="{{ order_product.sort_order }}" class="form-control" style="width:50px !important;" /></td>
													<td class="text-center"></td>
												</tr>
												{% set product_row = product_row + 1 %}
											{% endfor %}
											{% set voucher_row = 0 %}
											{% for order_voucher in order_vouchers %}
												<tr>
													<td class="text-left">
														{{ order_voucher.description }}
														<input type="hidden" name="voucher[{{ voucher_row }}][voucher_id]" value="{{ order_voucher.voucher_id }}" />
														<input type="hidden" name="voucher[{{ voucher_row }}][description]" value="{{ order_voucher.description }}" />
														<input type="hidden" name="voucher[{{ voucher_row }}][code]" value="{{ order_voucher.code }}" />
														<input type="hidden" name="voucher[{{ voucher_row }}][from_name]" value="{{ order_voucher.from_name }}" />
														<input type="hidden" name="voucher[{{ voucher_row }}][from_email]" value="{{ order_voucher.from_email }}" />
														<input type="hidden" name="voucher[{{ voucher_row }}][to_name]" value="{{ order_voucher.to_name }}" />
														<input type="hidden" name="voucher[{{ voucher_row }}][to_email]" value="{{ order_voucher.to_email }}" />
														<input type="hidden" name="voucher[{{ voucher_row }}][voucher_theme_id]" value="{{ order_voucher.voucher_theme_id }}" />
														<input type="hidden" name="voucher[{{ voucher_row }}][message]" value="{{ order_voucher.message }}" />
														<input type="hidden" name="voucher[{{ voucher_row }}][amount]" value="{{ order_voucher.amount }}" />
													</td>
													{% if product_column_image %}
														<td class="text-left"></td>
													{% endif %}
													<td class="text-left"></td>
													<td class="text-right">1</td>
													{% if product_column_price %}
														<td class="text-right"></td>
													{% endif %}
													{% if product_column_total %}
														<td class="text-right"></td>
													{% endif %}
													{% if product_column_cost %}
														<td class="text-right"></td>
													{% endif %}
													{% if product_column_notax %}
														<td class="text-center"></td>
													{% endif %}
													{% if product_column_pricet %}
														<td class="text-right"></td>
													{% endif %}
													{% if product_column_totalt %}
														<td class="text-right"></td>
													{% endif %}
													<td class="text-center"></td>
													<td class="text-center"></td>
												</tr>
												{% set voucher_row = voucher_row + 1 %}
											{% endfor %}
										{% else %}
											<tr>
												<td class="text-center" colspan="{{ columns }}">{{ text_no_results }}</td>
											</tr>
										{% endif %}
									</tbody>
								</table>
								<div class="row">
									<div class="col-sm-6 text-left">&nbsp;</div>
									<div class="col-sm-6 text-right">
										<button style="margin-bottom:13px;" type="button" id="button-add-product" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i> {{ button_product_add }}</button>
										<button style="margin-bottom:13px;" type="button" id="button-add-voucher" data-loading-text="{{ text_loading }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i> {{ button_voucher_add }}</button>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<div id="tab-total">
			<form id="total-form" class="form-horizontal">
				<div class="row">
					<div class="col-md-4">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title"><i class="fa fa-cog"></i> {{ text_order_options }}</h3>
							</div>
							<div class="panel-body">
								<input type="hidden" name="store_credit" value="{{ store_credit }}" />
								<fieldset>
									<div class="form-group">
										<label class="col-sm-3 control-label" for="input-coupon">{{ entry_coupon }}</label>
										<div class="col-sm-8">
											<input type="text" name="coupon" value="{{ coupon }}" id="input-coupon" data-loading-text="{{ text_loading }}" class="form-control" />
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-3 control-label" for="input-voucher">{{ entry_voucher }}</label>
										<div class="col-sm-8">
											<input type="text" name="voucher" value="{{ voucher }}" id="input-voucher" data-loading-text="{{ text_loading }}" class="form-control" />
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-3 control-label" for="input-reward" id="label-reward">{{ entry_reward }}<br/><small>{{ points_avail }}</small></label>
										<div class="col-sm-8">
											<input type="text" name="reward" value="{{ reward }}" id="input-reward" data-loading-text="{{ text_loading }}" class="form-control" />
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-3 control-label" for="input-affiliate">{{ entry_affiliate }}</label>
										<div class="col-sm-8">
											<input type="text" name="affiliate" value="{{ affiliate }}" id="input-affiliate" class="form-control" />
											<input type="hidden" name="affiliate_id" value="{{ affiliate_id }}" />
										</div>
									</div>
								</fieldset>
							</div>
						</div>
					</div>
					<div class="col-md-4">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title"><i class="fa fa-info-circle"></i> {{ text_order_options2 }}</h3>
							</div>
							<div class="panel-body">
								<fieldset>
									<div class="form-group">
										<label class="col-sm-3 control-label" for="input-ref-no">{{ entry_ref_no }}</label>
										<div class="col-sm-8">
											<input type="text" name="ref_no" id="input-ref-no" value="{{ ref_no }}" class="form-control" />
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-3 control-label" for="input-order-status">{{ entry_order_status }}</label>
										<div class="col-sm-8">
											<select name="order_status_id" id="input-order-status" class="form-control">
												{% for order_status in order_statuses %}
													{% if order_status.order_status_id == order_status_id %}
														<option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
													{% else %}
														<option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
													{% endif %}
												{% endfor %}
											</select>
											<input type="hidden" name="order_id" value="{{ order_id }}" />
											<input type="hidden" name="temp_order_id" value="{{ order_id }}" />
											<input type="hidden" name="quote_id" value="{{ quote_id }}" />
											<input type="hidden" name="temp_quote_id" value="" />
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-3 control-label" for="input-comment">{{ entry_comment }}</label>
										<div class="col-sm-8">
											<textarea name="comment" rows="5" id="input-comment" class="form-control">{{ comment }}</textarea>
										</div>
									</div>
									{% if order_quote == 'order' %}
										<div class="form-group required">
											<label class="col-sm-3 control-label" for="input-shipping-method">{{ entry_shipping_method }}</label>
											<div class="col-sm-8">
												<select name="shipping_method" id="input-shipping-method" class="form-control">
													<option value="">{{ text_select }}</option>
													{% if shipping_code %}
														<option value="{{ shipping_code }}" selected="selected">{{ shipping_method }}</option>
													{% endif %}
												</select>
											</div>
										</div>
										<div id="custom-shipping" class="form-group" style="display:none;">
											<label class="col-sm-3 control-label" for="input-custom-shipping-title">{{ entry_custom_shipping_title }}</label>
											<div class="col-sm-7">
												<input type="text" name="custom_shipping_title" id="input-custom-shipping-title" value="{{ custom_shipping_title }}" class="form-control" />
											</div>
											<br /><br /><br />
											<label class="col-sm-3 control-label" for="input-custom-shipping-cost">{{ entry_custom_shipping_cost }}</label>
											<div class="col-sm-7">
												<input type="text" name="custom_shipping_cost" id="input-custom-shipping-cost" value="{{ custom_shipping_cost }}" class="form-control" />
											</div>
											<div class="col-sm-1" style="margin-top:8px;">
												<button type="button" id="button-custom-shipping-apply" title="{{ button_custom_shipping_apply }}" class="btn btn-success btn-xs"><i class="fa fa-plus-circle"></i></button>
											</div>
										</div>
									{% else %}
										<div class="form-group">
											<label class="col-sm-3 control-label" for="input-shipping-method">{{ entry_shipping_method }}</label>
											<div class="col-sm-8">
												<select name="shipping_method" id="input-shipping-method" class="form-control">
													<option value="">{{ text_select }}</option>
													{% if shipping_code %}
														<option value="{{ shipping_code }}" selected="selected">{{ shipping_method }}</option>
													{% endif %}
												</select>
											</div>
										</div>
										<div id="custom-shipping" class="form-group" style="display:none;">
											<label class="col-sm-3 control-label" for="input-custom-shipping-title">{{ entry_custom_shipping_title }}</label>
											<div class="col-sm-7">
												<input type="text" name="custom_shipping_title" id="input-custom-shipping-title" value="{{ custom_shipping_title }}" class="form-control" />
											</div>
											<br /><br /><br />
											<label class="col-sm-3 control-label" for="input-custom-shipping-cost">{{ entry_custom_shipping_cost }}</label>
											<div class="col-sm-7">
												<input type="text" name="custom_shipping_cost" id="input-custom-shipping-cost" value="{{ custom_shipping_cost }}" class="form-control" />
											</div>
											<div class="col-sm-1" style="margin-top:8px;">
												<button type="button" id="button-custom-shipping-apply" title="{{ button_custom_shipping_apply }}" class="btn btn-success btn-xs"><i class="fa fa-plus-circle"></i></button>
											</div>
										</div>
									{% endif %}
								</fieldset>
							</div>
						</div>
					</div>
					<div class="col-md-4">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title"><i class="fa fa-credit-card"></i> {{ text_order_totals }}</h3>
							</div>
							<div class="panel-body">
								<div class="table-responsive">
									<table class="table table-bordered">
										<tbody id="total">
											<tr>
												<td class="text-center" colspan="5">{{ text_no_results }}</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title"><i class="fa fa-credit-card"></i> {{ text_order_payment }}</h3>
							</div>
							<div class="panel-body">
								<fieldset>
									<div class="form-group required">
										<label class="col-sm-4 control-label" for="input-payment-method">{{ entry_payment_method }}</label>
										<div class="col-sm-8">
											<input type="hidden" name="order_balance" value="{{ order_balance }}" />
											<select name="payment_method" id="input-payment-method" class="form-control">
												{% if order_quote == 'quote' %}
													{% for payment_method in payment_methods %}
														{% if payment_code == payment_method.code %}
															<option value="{{ payment_method.code }}" selected="selected">{{ payment_method.title }}</option>
														{% else %}
															<option value="{{ payment_method.code }}">{{ payment_method.title }}</option>
														{% endif %}
													{% endfor %}
												{% else %}
													<option value="">{{ text_select }}</option>
													{% if payment_code %}
														<option value="{{ payment_code }}" selected="selected">{{ payment_method }}</option>
													{% endif %}
												{% endif %}
											</select>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-10 control-label" for="input-no-tax">{{ text_no_tax2 }}</label>
										<div class="col-sm-2">
											<div class="checkbox">
												<label>
													{% if no_tax %}
														<input type="checkbox" name="no_tax" id="input-no-tax" value="1" checked="checked" />
													{% else %}
														<input type="checkbox" name="no_tax" id="input-no-tax" value="1" />
													{% endif %}
												</label>
											</div>
										</div>
									</div>
									{% if order_quote == 'quote' %}
										<div class="form-group">
											<label class="col-sm-10 control-label" for="input-soft-quote"><span data-toggle="tooltip" title="{{ help_soft_quote }}">{{ entry_soft_quote }}</span></label>
											<div class="col-sm-2">
												<div class="checkbox">
													<label>
														{% if soft_quote %}
															<input type="checkbox" name="soft_quote" id="input-soft-quote" value="1" checked="checked" />
														{% else %}
															<input type="checkbox" name="soft_quote" id="input-soft-quote" value="1" />
														{% endif %}
													</label>
												</div>
											</div>
										</div>
									{% endif %}
									<div class="form-group">
										<label class="col-sm-10 control-label" for="input-notify-customer-order">{{ text_notify_customer_order }}</label>
										<div class="col-sm-2">
											<div class="checkbox">
												<label>
													{% if module_order_entry_order_notification %}
														<input type="checkbox" name="notify_customer_order" id="input-notify-customer-order" value="1" />
													{% else %}
														<input type="checkbox" name="notify_customer_order" id="input-notify-customer-order" value="1" checked="checked" />
													{% endif %}
												</label>
											</div>
										</div>
									</div>
								</fieldset>
							</div>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-6 text-left">&nbsp;</div>
					<div class="col-sm-6 text-right">
						<button style="display:none;" type="button" id="button-refresh" data-toggle="tooltip" title="{{ button_refresh }}" data-loading-text="{{ text_loading }}" class="btn btn-warning"><i class="fa fa-refresh"></i></button>
						<button type="button" id="button-save" class="btn btn-primary"><i class="fa fa-check-circle"></i> {{ button_save }}</button>
						<a onclick="cancel();" class="btn btn-default"><i class="fa fa-reply"></i> {{ button_cancel }}</a>
					</div>
				</div>
				<input type="hidden" name="shipping_required" value="0" />
				<input type="hidden" name="total_products" value="0" />
			</form>
		</div>
	</div>
	<script type="text/javascript"><!--

		{% if not shipping_address_same %}
			$('input[name=\'shipping_same_payment\']').prop('checked', false);
			$('#edit-customer-saddr').show();
		{% else %}
			$('#edit-customer-saddr').hide();
		{% endif %}

		// Disable the tabs
		$('#order a[data-toggle=\'tab\']').on('click', function(e) {
			return false;
		});

		$(document).ready(function() {
			$('input[name=\'currency_id\']').trigger('change');
		});

		$(document).delegate('#button-ip-add', 'click', function() {
			$.ajax({
				url: 'index.php?route=user/api/addip&user_token={{ token }}&api_id={{ api_id }}',
				type: 'post',
				data: 'ip={{ api_ip}}',
				dataType: 'json',
				cache: false,
				beforeSend: function() {
					$('#button-ip-add').button('loading');
				},
				complete: function() {
					$('#button-ip-add').button('reset');
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					if (json['error']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
					}
					if (json['success']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						location.reload();
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
				}
			});
		});

		// Currency
		$('input[name=\'currency_id\']').on('change', function() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/currency&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: 'currency=' + $('select[name=\'currency\'] option:selected').val(),
				dataType: 'json',
				cache: false,
				crossDomain: true,
				beforeSend: function() {
					$('select[name=\'currency\']').prop('disabled', true);
				},
				complete: function() {
					$('select[name=\'currency\']').prop('disabled', false);
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						// Highlight any found errors
						$('select[name=\'currency\']').closest('.form-group').addClass('has-error');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
				}
			});
		});

		$('select[name=\'currency\']').on('change', function() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/currency&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: 'currency=' + $('select[name=\'currency\'] option:selected').val(),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				beforeSend: function() {
					$('select[name=\'currency\']').prop('disabled', true);
				},
				complete: function() {
					$('select[name=\'currency\']').prop('disabled', false);
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger alert-dismissible"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						// Highlight any found errors
						$('select[name=\'currency\']').closest('.form-group').addClass('has-error');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
				}
			}).done(function() {
				$('#button-refresh').trigger('click');
			});
		});
		
		// Order Entry added functions

		$('select[name=\'store_id\']').on('change', function() {
			$('input[name=\'store_id\']').val($('input[name=\'store_id\']').val());
			$('input[name=\'store\']').val($('input[name=\'store_id\']').val());
		});

		// Startup operations
		function orderStartup() {
			popgreyscreenwait();
			setTimeout(function() {
				setCustomer();
			}, 3000);
		}
		{% if order_quote == 'order' and not copy_order %}
			if ($('#total-form input[name=\'order_id\']').val() > 0) {
				orderStartup();
			}
		{% elseif copy_order %}
			orderStartup();
		{% else %}
			if ($('input[name=\'quote_id\']').val() > 0) {
				popgreyscreenwait();
				setTimeout(function() {
					setCustomer();
				}, 2000);
			}
		{% endif %}

		// Verify email doesn't already exist when creating a new order
		function checkEmail() {
			$.ajax({
				url: 'index.php?route=extension/sale/order_entry/checkEmail&user_token={{ user_token }}&email=' + encodeURIComponent($('input[name=\'email\']').val()),
				type: 'GET',
				dataType: 'json',
				cache: false,
				success: function(json) {
					if (json == 'exists') {
						$('#customer-information input[name=\'email\']').parent().addClass('has-error');
						alert('{{ text_email_exists }}');
					} else if (json == 'new') {
						$('#close-customer-info').trigger('click');
						setCustomerInfo(0);
					} else {
						$('#close-customer-info').trigger('click');
						setCustomerInfo(-1);
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		}

		// Set customer information
		function setCustomerInfo(cvalue) {
			$('#customer-information input[name=\'email\']').parent().removeClass('has-error');
			$('#customer-group').html($('#customer-information select[name=\'customer_group_id\']').children('option:selected').text());
			$('#customer-name').html($('#customer-information input[name=\'firstname\']').val() + ' ' + $('#customer-information input[name=\'lastname\']').val());
			$('#customer-address input[name=\'firstname\']').val($('#customer-information input[name=\'firstname\']').val());
			$('#customer-address input[name=\'lastname\']').val($('#customer-information input[name=\'lastname\']').val());
			$('#customer-email').html($('#customer-information input[name=\'email\']').val());
			$('#customer-telephone').html($('#customer-information input[name=\'telephone\']').val());
			if ($('#customer-information input[name=\'customer_id\']').val() == 0) {
				if (cvalue == 0) {
					$('#new-customer').show();
				} else {
					$('#new-customer').hide();
					$('#new-customer input[name=\'save_customer\']').attr('checked', false);
					$('#new-customer input[name=\'notify_customer\']').attr('checked', false);
				}
			} else {
				$('#new-customer').hide();
				$('#new-customer input[name=\'save_customer\']').attr('checked', false);
				$('#new-customer input[name=\'notify_customer\']').attr('checked', false);
			}
			setCustomer(cvalue);
		}
		function setCustomer(clearadd) {
			var c_address_error = 0;
			$.ajax({
				url: '{{ catalog }}index.php?route=api/customer&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: $('#customer-information input[type=\'text\'], #customer-information input[type=\'hidden\'], #customer-information input[type=\'radio\']:checked, #customer-information input[type=\'checkbox\']:checked, #customer-information select, #customer-information textarea'),
				dataType: 'json',
				cache: false,
				crossDomain: true,
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						if (json['error']['warning']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						}
						for (i in json['error']) {
							var element = $('#input-' + i.replace('_', '-'));
							if (element.parent().hasClass('input-group')) {
								$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
							} else {
								$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
							}
						}
						$('.text-danger').parentsUntil('.form-group').parent().addClass('has-error');
						{% if order_quote == 'order' %}
							$('#close-customer-info').hide();
							$('#close-customer-info1').hide();
							$('#customer-information').show();
							c_address_error = 1;
						{% endif %}
					}
					if ($('#customer-address input[name=\'address_1\']').val() != '' && clearadd > 0) {
						clearaddressinfo();
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				if (c_address_error == 0) {
					$('#close-customer-info').show();
					$('#close-customer-info1').show();
					{% if not copy_order and order_quote == 'order' %}
						{% if show_previous_orders %}
							getOrders();
						{% endif %}
						if ($('#total-form input[name=\'order_id\']').val() > 0) {
							if ($('input[name=\'store_credit\']').val() > 0 || $('input[name=\'coupon\']').val() != '' || $('input[name=\'reward\']').val() > 0) {
								var dataString = '';
								if ($('input[name=\'store_credit\']').val() > 0) {
									dataString += 'store_credit=' + $('input[name=\'store_credit\']').val();
								}
								if ($('input[name=\'coupon\']').val() != '') {
									if (dataString != '') {
										dataString += '&coupon=' + $('input[name=\'coupon\']').val();
									} else {
										dataString += 'coupon=' + $('input[name=\'coupon\']').val();
									}
								}
								if ($('input[name=\'reward\']').val() > 0) {
									if (dataString != '') {
										dataString += '&reward=' + $('input[name=\'reward\']').val();
									} else {
										dataString += 'reward=' + $('input[name=\'reward\']').val();
									}
								}
								$.ajax({
									url: '{{ catalog }}index.php?route=extension/api/order_entry/SetStoreCredit&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
									type: 'POST',
									dataType: 'json',
									data: dataString,
									cache: false,
									crossDomain: true,
									success: function(json) {
									},
									error: function(xhr, ajaxOptions, thrownError) {
										alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
										closegreyscreen();
									}
								});
							}
							cartAdd();
							setPaymentAddress();
						} else {
							closegreyscreen();
						}
					{% elseif copy_order %}
						{% if show_previous_orders %}
							getOrders();
						{% endif %}
						if ($('input[name=\'store_credit\']').val() > 0 || $('input[name=\'coupon\']').val() != '') {
							var dataString = '';
							if ($('input[name=\'store_credit\']').val() > 0) {
								dataString += 'store_credit=' + $('input[name=\'store_credit\']').val();
							}
							if ($('input[name=\'coupon\']').val() != '') {
								if (dataString != '') {
									dataString += '&coupon=' + $('input[name=\'coupon\']').val();
								} else {
									dataString += 'coupon=' + $('input[name=\'coupon\']').val();
								}
							}
							$.ajax({
								url: '{{ catalog }}index.php?route=extension/api/order_entry/setStoreCredit&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
								type: 'POST',
								dataType: 'json',
								data: dataString,
								cache: false,
								crossDomain: true,
								success: function(json) {
								},
								error: function(xhr, ajaxOptions, thrownError) {
									alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
									closegreyscreen();
								}
							});
						}
						cartAdd();
						setPaymentAddress();
					{% else %}
						if ($('#total-form input[name=\'quote_id\']').val() > 0) {
							cartAdd();
							setPaymentAddress();
						} else {
							closegreyscreen();
						}
					{% endif %}
				}
			});
		}
		function getOrders() {
			if ($('input[name=\'customer_id\']').val() > 0) {
				$.ajax({
					url: 'index.php?route=extension/sale/order_entry/getCustomerOrders&user_token={{ user_token }}&customer_id=' + $('input[name=\'customer_id\']').val(),
					type: 'GET',
					dataType: 'json',
					cache: false,
					success: function(json) {
						if (json['has_orders'] == 1) {
							$('#previous-orders-table').html(json['orders']);
						}
					},
					error: function(xhr, ajaxOptions, thrownError) {
						alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					}
				});
			}
		}
		function clearaddressinfo() {
			popgreyscreenwait();
			$('#pa-company').html('');
			$('#pa-name').html('');
			$('#pa-address-1').html('');
			$('#pa-address-2').html('');
			$('#pa-address-3').html('');
			$('#pa-country').html('');
			$('#sa-company').html('');
			$('#sa-name').html('');
			$('#sa-address-1').html('');
			$('#sa-address-2').html('');
			$('#sa-address-3').html('');
			$('#sa-country').html('');
			$('#customer-address input[type=\'text\']').val('');
			$('#customer-saddress input[type=\'text\']').val('');
		}

		// Set payment address
		function setPaymentAddress() {
			var address_3 = '';
			if ($('#customer-address input[name=\'city\']').val().trim() != '') {
				address_3 += $('#customer-address input[name=\'city\']').val();
				if ($('#customer-address select[name=\'zone_id\']').val() > 0) {
					address_3 += ', ' + $('#customer-address select[name=\'zone_id\']').children('option:selected').text();
				}
				address_3 += ', ' + $('#customer-address input[name=\'postcode\']').val();
			} else {
				if ($('#customer-address select[name=\'zone_id\']').val() > 0) {
					address_3 += $('#customer-address select[name=\'zone_id\']').children('option:selected').text();
				}
				address_3 += ', ' + $('#customer-address input[name=\'postcode\']').val();
			}
			if ($('#customer-address input[name=\'company\']').val() != '') {
				$('#pa-company').html($('#customer-address input[name=\'company\']').val());
				$('#pa-company-box').show();
			} else {
				$('#pa-company-box').hide();
			}
			$('#pa-name').html($('#customer-address input[name=\'firstname\']').val() + ' ' + $('#customer-address input[name=\'lastname\']').val());
			$('#pa-address-1').html($('#customer-address input[name=\'address_1\']').val());
			if ($('#customer-address input[name=\'address_2\']').val() != '') {
				$('#pa-address-2').html($('#customer-address input[name=\'address_2\']').val());
				$('#pa-address-2-box').show();
			} else {
				$('#pa-address-2-box').hide();
			}
			$('#pa-address-3').html(address_3);
			$('#pa-country').html($('#customer-address select[name=\'country_id\']').children('option:selected').text());
			$('#customer-address input[name=\'country\']').val($('#customer-address select[name=\'country_id\']').children('option:selected').text());
			$('#customer-address input[name=\'zone\']').val($('#customer-address select[name=\'zone_id\']').children('option:selected').text());
			$('#button-payment-address').trigger('click');
		}

		// Set shipping address using payment address
		function setShippingAddress1() {
			$('#edit-customer-saddr').hide();
			$('#customer-saddress input[name=\'firstname\']').val($('#customer-address input[name=\'firstname\']').val());
			$('#customer-saddress input[name=\'lastname\']').val($('#customer-address input[name=\'lastname\']').val());
			$('#customer-saddress input[name=\'company\']').val($('#customer-address input[name=\'company\']').val());
			$('#customer-saddress input[name=\'address_1\']').val($('#customer-address input[name=\'address_1\']').val());
			$('#customer-saddress input[name=\'address_2\']').val($('#customer-address input[name=\'address_2\']').val());
			$('#customer-saddress input[name=\'city\']').val($('#customer-address input[name=\'city\']').val());
			$('#customer-saddress input[name=\'postcode\']').val($('#customer-address input[name=\'postcode\']').val());
			$('#customer-saddress select[name=\'country_id\']').val($('#customer-address select[name=\'country_id\']').val());
			$('#customer-saddress select[name=\'zone_id\']').val($('#customer-address select[name=\'zone_id\']').val());
			$('#customer-saddress input[name=\'country\']').val($('#customer-address select[name=\'country_id\']').children('option:selected').text());
			$('#customer-saddress input[name=\'zone\']').val($('#customer-address select[name=\'zone_id\']').children('option:selected').text());
			var address_3 = '';
			if ($('#customer-address input[name=\'city\']').val().trim() != '') {
				address_3 += $('#customer-address input[name=\'city\']').val();
				if ($('#customer-address select[name=\'zone_id\']').val() > 0) {
					address_3 += ', ' + $('#customer-address select[name=\'zone_id\']').children('option:selected').text();
				}
				address_3 += ', ' + $('#customer-address input[name=\'postcode\']').val();
			} else {
				if ($('#customer-address select[name=\'zone_id\']').val() > 0) {
					address_3 += $('#customer-address select[name=\'zone_id\']').children('option:selected').text();
				}
				address_3 += ', ' + $('#customer-address input[name=\'postcode\']').val();
			}
			if ($('#customer-address input[name=\'company\']').val() != '') {
				$('#sa-company').html($('#customer-address input[name=\'company\']').val());
				$('#sa-company-box').show();
			} else {
				$('#sa-company-box').hide();
			}
			$('#sa-name').html($('#customer-address input[name=\'firstname\']').val() + ' ' + $('#customer-address input[name=\'lastname\']').val());
			$('#sa-address-1').html($('#customer-address input[name=\'address_1\']').val());
			if ($('#customer-address input[name=\'address_2\']').val() != '') {
				$('#sa-address-2').html($('#customer-address input[name=\'address_2\']').val());
				$('#sa-address-2-box').show();
			} else {
				$('#sa-address-2-box').hide();
			}
			$('#sa-address-3').html(address_3);
			$('#sa-country').html($('#customer-address select[name=\'country_id\']').children('option:selected').text());
			$.ajax({
				url: '{{ catalog }}index.php?route=extension/api/order_entry/getZoneCode&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'POST',
				data: 'zone_id=' + encodeURIComponent($('#customer-saddress select[name=\'zone_id\']').val()),
				dataType: 'json',
				cache: false,
				crossDomain: true,
				success: function(json) {
					if (json['zone_code']) {
						$('#customer-saddress input[name=\'zone_code\']').val(json['zone_code']);
					}
				}
			})
			$('#button-shipping-address').trigger('click');
		}

		// Set shipping address using the shipping address
		function setShippingAddress2() {
			$('#edit-customer-saddr').show();
			var address_3 = '';
			if ($('#customer-saddress input[name=\'city\']').val().trim() != '') {
				address_3 += $('#customer-saddress input[name=\'city\']').val();
				if ($('#customer-saddress select[name=\'zone_id\']').val() > 0) {
					address_3 += ', ' + $('#customer-saddress select[name=\'zone_id\']').children('option:selected').text();
				}
				address_3 += ', ' + $('#customer-saddress input[name=\'postcode\']').val();
			} else {
				if ($('#customer-saddress select[name=\'zone_id\']').val() > 0) {
					address_3 += $('#customer-saddress select[name=\'zone_id\']').children('option:selected').text();
				}
				address_3 += ', ' + $('#customer-saddress input[name=\'postcode\']').val();
			}
			if ($('#customer-saddress input[name=\'company\']').val() != '') {
				$('#sa-company').html($('#customer-saddress input[name=\'company\']').val());
				$('#sa-company-box').show();
			} else {
				$('#sa-company-box').hide();
			}
			$('#sa-name').html($('#customer-saddress input[name=\'firstname\']').val() + ' ' + $('#customer-saddress input[name=\'lastname\']').val());
			$('#sa-address-1').html($('#customer-saddress input[name=\'address_1\']').val());
			if ($('#customer-saddress input[name=\'address_2\']').val() != '') {
				$('#sa-address-2').html($('#customer-saddress input[name=\'address_2\']').val());
				$('#sa-address-2-box').show();
			} else {
				$('#sa-address-2-box').hide();
			}
			$('#sa-address-3').html(address_3);
			$('#sa-country').html($('#customer-saddress select[name=\'country_id\']').children('option:selected').text());
			$.ajax({
				url: '{{ catalog }}index.php?route=extension/api/order_entry/getZoneCode&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'POST',
				data: 'zone_id=' + encodeURIComponent($('#customer-saddress select[name=\'zone_id\']').val()),
				dataType: 'json',
				cache: false,
				crossDomain: true,
				success: function(json) {
					if (json['zone_code']) {
						$('#customer-saddress input[name=\'zone_code\']').val(json['zone_code']);
					}
				}
			})
			$('#button-shipping-address').trigger('click');
		}

		// Add products to cart when editing orders
		function cartAdd() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/cart/add&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: $('#cart input[name^=\'product\'][type=\'text\'], #cart input[name^=\'product\'][type=\'hidden\'], #cart input[name^=\'product\'][type=\'radio\']:checked, #cart input[name^=\'product\'][type=\'checkbox\']:checked, #cart select[name^=\'product\'], #cart textarea[name^=\'product\']'),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error'] && json['error']['warning']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		}

		// Add vouchers to cart when editing orders
		function voucherAdd() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/voucher/add&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: $('#cart input[name^=\'voucher\'][type=\'text\'], #cart input[name^=\'voucher\'][type=\'hidden\'], #cart input[name^=\'voucher\'][type=\'radio\']:checked, #cart input[name^=\'voucher\'][type=\'checkbox\']:checked, #cart select[name^=\'voucher\'], #cart textarea[name^=\'voucher\']'),
				dataType: 'json',
				cache: false,
				crossDomain: true,
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error'] && json['error']['warning']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		}

		// Payment methods
		function getPaymentMethods() {
			{% if order_quote == 'order' %}
				$.ajax({
					url: '{{ catalog }}index.php?route=api/payment/methods&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
					type: 'GET',
					dataType: 'json',
					crossDomain: true,
					cache: false,
					success: function(json) {
						if (json['error']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
							closegreyscreen();
						} else {
							html = '<option value="">{{ text_select}}</option>';
							if (json['payment_methods']) {
								for (i in json['payment_methods']) {
									if (json['payment_methods'][i]['code'] == $('select[name=\'payment_method\'] option:selected').val()) {
										html += '<option value="' + json['payment_methods'][i]['code'] + '" selected="selected">' + json['payment_methods'][i]['title'] + '</option>';
									} else {
										html += '<option value="' + json['payment_methods'][i]['code'] + '">' + json['payment_methods'][i]['title'] + '</option>';
									}
								}
							}
							$('select[name=\'payment_method\']').html(html);
							{% if not copy_order %}
								if ($('#total-form input[name=\'order_id\']').val() > 0) {
									$('#input-payment-method').trigger('change');
								} else {
									getShippingMethods();
								}
							{% else %}
								$('#input-payment-method').trigger('change');
							{% endif %}
						}
					},
					error: function(xhr, ajaxOptions, thrownError) {
						alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						closegreyscreen();
					}
				});
			{% else %}
				getShippingMethods();
			{% endif %}
		}

		// Get Shipping Methods
		function getShippingMethods() {
			{% if module_order_entry_require_city %}
				if ($('#customer-saddress input[name=\'address_1\']').val() != '' && $('#customer-saddress input[name=\'city\']').val() != '') {
			{% else %}
				if ($('#customer-saddress input[name=\'address_1\']').val() != '') {
			{% endif %}
				$.ajax({
					url: '{{ catalog }}index.php?route=api/shipping/methods&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
					type: 'GET',
					dataType: 'json',
					crossDomain: true,
					cache: false,
					success: function(json) {
						if (json['error']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
							alert(json['error']);
							html = '<option value="">{{ text_select}}</option>';
							$('select[name=\'shipping_method\']').html(html);
							$('#button-refresh').trigger('click');
						} else {
							html = '<option value="">{{ text_select}}</option>';
							if (json['shipping_methods']) {
								for (i in json['shipping_methods']) {
									html += '<optgroup label="' + json['shipping_methods'][i]['title'] + '">';
									if (!json['shipping_methods'][i]['error']) {
										for (j in json['shipping_methods'][i]['quote']) {
											if (json['shipping_methods'][i]['quote'][j]['code'] == $('select[name=\'shipping_method\'] option:selected').val()) {
												html += '<option value="' + json['shipping_methods'][i]['quote'][j]['code'] + '" selected="selected">' + json['shipping_methods'][i]['quote'][j]['title'] + ' - ' + json['shipping_methods'][i]['quote'][j]['text'] + '</option>';
											} else {
												html += '<option value="' + json['shipping_methods'][i]['quote'][j]['code'] + '">' + json['shipping_methods'][i]['quote'][j]['title'] + ' - ' + json['shipping_methods'][i]['quote'][j]['text'] + '</option>';
											}
										}
									} else {
										html += '<option value="" style="color: #F00;" disabled="disabled">' + json['shipping_methods'][i]['error'] + '</option>';
									}
									html += '</optgroup>';
								}
							}
							$('select[name=\'shipping_method\']').html(html);
							if (($('#total-form input[name=\'order_id\']').val() > 0 && json['shipping_methods']) || $('select[name=\'shipping_method\']').val() != '') {
								$('#input-shipping-method').trigger('change');
							} else {
								$('#button-refresh').trigger('click');
							}
						}
					},
					error: function(xhr, ajaxOptions, thrownError) {
						alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						closegreyscreen();
					}
				});
			} else {
				$('#button-refresh').trigger('click');
			}
		}

		// Check for valid customer and address before allowing product to be added to order
		function customerValidate() {
			if ($('#customer-information input[name=\'firstname\']').val().trim() == '') {
				return false;
			}
			{% if module_order_entry_require_lastname %}
				if ($('#customer-information input[name=\'lastname\']').val().trim() == '') {
					return false;
				}
			{% endif %}
			{% if module_order_entry_require_email %}
				if ($('#customer-information input[name=\'email\']').val().trim() == '') {
					return false;
				}
			{% endif %}
			{% if module_order_entry_require_telephone %}
				if ($('#customer-information input[name=\'telephone\']').val().trim() == '') {
					return false;
				}
			{% endif %}
			{% if order_quote == 'order' %}
				if ($('#customer-address input[name=\'firstname\']').val().trim() == '') {
					return false;
				}
				{% if module_order_entry_require_lastname %}
					if ($('#customer-address input[name=\'lastname\']').val().trim() == '') {
						return false;
					}
				{% endif %}
				if ($('#customer-address input[name=\'address_1\']').val().trim() == '') {
					return false;
				}
				{% if module_order_entry_require_city %}
					if ($('#customer-address input[name=\'city\']').val().trim() == '') {
						return false;
					}
				{% endif %}
				if ($('#customer-address select[name=\'country_id\']').val() < 1) {
					return false;
				}
				{% if module_order_entry_require_zone %}
					if ($('#customer-address select[name=\'zone_id\']').val() < 1) {
						return false;
					}
				{% endif %}
				if ($('#customer-saddress input[name=\'firstname\']').val().trim() == '') {
					return false;
				}
				{% if module_order_entry_require_lastname %}
					if ($('#customer-saddress input[name=\'lastname\']').val().trim() == '') {
						return false;
					}
				{% endif %}
				if ($('#customer-saddress input[name=\'address_1\']').val().trim() == '') {
					return false;
				}
				{% if module_order_entry_require_city %}
					if ($('#customer-saddress input[name=\'city\']').val().trim() == '') {
						return false;
					}
				{% endif %}
				if ($('#customer-saddress select[name=\'country_id\']').val() < 1) {
					return false;
				}
				{% if module_order_entry_require_zone %}
					if ($('#customer-saddress select[name=\'zone_id\']').val() < 1) {
						return false;
					}
				{% endif %}
			{% endif %}
			return true;
		}

		function checkOrder() {
			if ($('#customer-information input[name=\'firstname\']').val().trim() == '') {
				return -1;
			}
			{% if module_order_entry_require_lastname %}
				if ($('#customer-information input[name=\'lastname\']').val().trim() == '') {
					return -1;
				}
			{% endif %}
			{% if module_order_entry_require_email %}
				if ($('#customer-information input[name=\'email\']').val().trim() == '') {
					return -1;
				}
			{%endif %}
			{% if module_order_entry_require_telephone %}
				if ($('#customer-information input[name=\'telephone\']').val().trim() == '') {
					return -1;
				}
			{% endif %}
			{% if order_quote == 'order' %}
				if ($('#customer-address input[name=\'firstname\']').val().trim() == '') {
					return -2;
				}
				{% if module_order_entry_require_lastname %}
					if ($('#customer-address input[name=\'lastname\']').val().trim() == '') {
						return -2;
					}
				{% endif %}
				if ($('#customer-address input[name=\'address_1\']').val().trim() == '') {
					return -2;
				}
				{% if module_order_entry_require_city %}
					if ($('#customer-address input[name=\'city\']').val().trim() == '') {
						return -2;
					}
				{% endif %}
				if ($('#customer-address select[name=\'country_id\']').val() < 1) {
					return -2;
				}
				{% if module_order_entry_require_zone %}
					if ($('#customer-address select[name=\'zone_id\']').val() < 1) {
						return -2;
					}
				{% endif %}
				if ($('#total-form input[name=\'shipping_required\']').val() == 1) {
					if ($('#customer-saddress input[name=\'firstname\']').val().trim() == '') {
						return -3;
					}
					{% if module_order_entry_require_lastname %}
						if ($('#customer-saddress input[name=\'lastname\']').val().trim() == '') {
							return -3;
						}
					{% endif %}
					if ($('#customer-saddress input[name=\'address_1\']').val().trim() == '') {
						return -3;
					}
					{% if module_order_entry_require_city %}
						if ($('#customer-saddress input[name=\'city\']').val().trim() == '') {
							return -3;
						}
					{% endif %}
					if ($('#customer-saddress select[name=\'country_id\']').val() < 1) {
						return -3;
					}
					{% if module_order_entry_require_zone %}
						if ($('#customer-saddress select[name=\'zone_id\']').val() < 1) {
							return -3;
						}
					{% endif %}
				}
			{% endif %}
			if ($('#total-form input[name=\'total_products\']').val() < 1) {
				return -4;
			}
			{% if order_quote == 'order' %}
				if ($('#total-form input[name=\'shipping_required\']').val() == 1 && $('#total-form select[name=\'shipping_method\']').val() == 0) {
					return -5;
				}
			{% endif %}
			if ($('#total-form select[name=\'payment_method\']').val() == 0) {
				return -6;
			}
			return 1;
		}

		// Cancel order creation
		function cancel() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/order/clearcart&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				dataType: 'json',
				cache: false,
				complete: function() {
					var str = '{{ cancel }}';
					var href_loc = str.replace('&amp;', '&');
					location.href = href_loc;
				}
			});
		}

		// End Order Entry functions

		function popgreyscreen() {
			$('#grey_screen').css({ opacity: 0.7, 'width':$(document).width(),'height':$(document).height()});
			$('#grey_screen').show();
			$('body').css({'overflow':'hidden'});
		}

		function popgreyscreenwait() {
			$('#please_wait').show();
			$('#grey_screen').css({ opacity: 0.7, 'width':$(document).width(),'height':$(document).height()});
			$('#grey_screen').show();
			$('body').css({'overflow':'hidden'});
		}

		function closegreyscreen() {
			$('#please_wait').hide();
			$('#grey_screen').hide();
			$('body').css({'overflow':'auto'});
		}

		// Add or edit customer information
		$('#edit-customer-info').on('click', function() {
			$('#customer-information').show();
			popgreyscreen();
		});
		$('#close-customer-info1').on('click', function() {
			$('#close-customer-info').trigger('click');
		});
		$('#close-customer-info').on('click', function() {
			$('#customer-information').hide();
			closegreyscreen();
		});
		$('#button-customer-info').on('click', function() {
			if ($('#customer-information input[name=\'customer_id\']').val() == 0) {
				checkEmail();
			} else {
				$('#close-customer-info').trigger('click');
				popgreyscreenwait();
				setCustomerInfo(1);
			}
		});

		// Add - Edit Customer Payment Address
		$('#edit-customer-addr').on('click', function() {
			$('#customer-address').show();
			popgreyscreen();
		});
		$('#close-customer-addr1').on('click', function() {
			$('#close-customer-addr').trigger('click');
		});
		$('#close-customer-addr').on('click', function() {
			$('#customer-address').hide();
			closegreyscreen();
		});
		$('#button-save-customer-addr').on('click', function() {
			$('#close-customer-addr').trigger('click');
			popgreyscreenwait();
			setPaymentAddress();
		});
		$('input[name=\'shipping_same_payment\']').on('click', function() {
			var shipping_same = $(this).prop('checked');
			if (shipping_same) {
				$('#edit-customer-saddr').hide();
				$('#shipping-address').hide();
				$('#new-address').hide();
				$('input[name=\'save_address\']').prop('checked', false);
				if ($('#customer-information input[name=\'customer_id\']').val() > 0) {
					$('#customer-saddress select[name=\'shipping_address\']').val($('select[name=\'payment_address\']').val());
				}
				closegreyscreen();
				setShippingAddress1();
			} else {
				$('#edit-customer-saddr').show();
				$('#shipping-address').show();
				closegreyscreen();
			}
		});

		// Add - Edit Customer Shipping Address
		$('#edit-customer-saddr').on('click', function() {
			$('#customer-saddress').show();
			popgreyscreen();
		});
		$('#close-customer-saddr1').on('click', function() {
			$('#close-customer-saddr').trigger('click');
		});
		$('#close-customer-saddr').on('click', function() {
			$('#customer-saddress').hide();
			closegreyscreen();
		});
		$('#button-save-customer-saddr').on('click', function() {
			$('#close-customer-saddr').trigger('click');
			$('#customer-saddress select[name=\'shipping_address\']').val('0');
			popgreyscreenwait();
			setShippingAddress2();
			if ($('#customer-information input[name=\'customer_id\']').val() > 0) {
				$('#new-address').show();
			} else {
				$('#new-address').hide();
			}
		});

		// Set Payment Address Country and Zone
		var payment_zone_id = '{{ payment_zone_id }}';
		$('#customer-address select[name=\'country_id\']').on('change', function() {
			var same_shipping = $('input[name=\'shipping_same_payment\']').prop('checked');
			$.ajax({
				url: 'index.php?route=localisation/country/country&user_token={{ user_token }}&country_id=' + this.value,
				dataType: 'json',
				cache: false,
				success: function(json) {
					if (json['postcode_required'] == '1') {
						$('#customer-address input[name=\'postcode\']').parent().parent().addClass('required');
					} else {
						$('#customer-address input[name=\'postcode\']').parent().parent().removeClass('required');
					}
					html = '<option value="">{{ text_select }}</option>';
					if (json['zone'] && json['zone'] != '') {
						for (i = 0; i < json['zone'].length; i++) {
							html += '<option value="' + json['zone'][i]['zone_id'] + '"';
							if (json['zone'][i]['zone_id'] == payment_zone_id) {
								html += ' selected="selected"';
							}
							html += '>' + json['zone'][i]['name'] + '</option>';
						}
					} else {
						html += '<option value="0" selected="selected">{{ text_none }}</option>';
					}
					$('#customer-address select[name=\'zone_id\']').html(html);
					var same_shipping = $('input[name=\'shipping_same_payment\']').prop('checked');
					if (same_shipping) {
						$('#customer-saddress select[name=\'zone_id\']').html(html);
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		});
		$('#customer-address select[name=\'country_id\']').trigger('change');

		// Set Shipping Address Country and Zone
		var shipping_zone_id = '{{ shipping_zone_id }}';
		$('#customer-saddress select[name=\'country_id\']').on('change', function() {
			$.ajax({
				url: 'index.php?route=localisation/country/country&user_token={{ user_token }}&country_id=' + this.value,
				dataType: 'json',
				cache: false,
				success: function(json) {
					if (json['postcode_required'] == '1') {
						$('#customer-saddress input[name=\'postcode\']').parent().parent().addClass('required');
					} else {
						$('#customer-saddress input[name=\'postcode\']').parent().parent().removeClass('required');
					}
					html = '<option value="">{{ text_select }}</option>';
					if (json['zone'] && json['zone'] != '') {
						for (i = 0; i < json['zone'].length; i++) {
							html += '<option value="' + json['zone'][i]['zone_id'] + '"';
							if (json['zone'][i]['zone_id'] == shipping_zone_id) {
								html += ' selected="selected"';
							}
							html += '>' + json['zone'][i]['name'] + '</option>';
						}
					} else {
						html += '<option value="0" selected="selected">{{ text_none }}</option>';
					}
					$('#customer-saddress select[name=\'zone_id\']').html(html);
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		});
		$('#customer-saddress select[name=\'country_id\']').trigger('change');

		// Payment Address change
		$('select[name=\'payment_address\']').on('change', function() {
			var same_shipping = $('input[name=\'shipping_same_payment\']').prop('checked');
			var p_address_error = 0;
			$.ajax({
				url: 'index.php?route=customer/customer/address&user_token={{ user_token }}&address_id=' + this.value,
				dataType: 'json',
				cache: false,
				beforeSend: function(json) {
					popgreyscreenwait();
				},
				success: function(json) {
					if (json['error']) {
						{% if order_quote == 'order' %}
							p_address_error = 1;
							$('#customer-address').show();
						{% endif %}
					} else {
						$('#customer-address input[name=\'firstname\']').val(json['firstname']);
						$('#customer-address input[name=\'lastname\']').val(json['lastname']);
						$('#customer-address input[name=\'company\']').val(json['company']);
						$('#customer-address input[name=\'address_1\']').val(json['address_1']);
						$('#customer-address input[name=\'address_2\']').val(json['address_2']);
						$('#customer-address input[name=\'city\']').val(json['city']);
						$('#customer-address input[name=\'postcode\']').val(json['postcode']);
						$('#customer-address select[name=\'country_id\']').val(json['country_id']);
						payment_zone_id = json['zone_id'];
						for (i in json['custom_field']) {
							$('#customer-address select[name=\'custom_field[' + i + ']\']').val(json['custom_field'][i]);
							$('#customer-address textarea[name=\'custom_field[' + i + ']\']').val(json['custom_field'][i]);
							$('#customer-address input[name^=\'custom_field[' + i + ']\'][type=\'text\']').val(json['custom_field'][i]);
							$('#customer-address input[name^=\'custom_field[' + i + ']\'][type=\'hidden\']').val(json['custom_field'][i]);
							$('#customer-address input[name^=\'custom_field[' + i + ']\'][type=\'radio\'][value=\'' + json['custom_field'][i] + '\']').prop('checked', true);
							$('#customer-address input[name^=\'custom_field[' + i + ']\'][type=\'checkbox\'][value=\'' + json['custom_field'][i] + '\']').prop('checked', true);
							if (json['custom_field'][i] instanceof Array) {
								for (j = 0; j < json['custom_field'][i].length; j++) {
									$('#customer-address input[name^=\'custom_field[' + i + ']\'][type=\'checkbox\'][value=\'' + json['custom_field'][i][j] + '\']').prop('checked', true);
								}
							}
						}
						$('#customer-address select[name=\'country_id\']').trigger('change');
						if (same_shipping) {
							$('#customer-saddress select[name=\'shipping_address\']').val($('#customer-address select[name=\'payment_address\']').val());
							$('#customer-saddress input[name=\'firstname\']').val(json['firstname']);
							$('#customer-saddress input[name=\'lastname\']').val(json['lastname']);
							$('#customer-saddress input[name=\'company\']').val(json['company']);
							$('#customer-saddress input[name=\'address_1\']').val(json['address_1']);
							$('#customer-saddress input[name=\'address_2\']').val(json['address_2']);
							$('#customer-saddress input[name=\'city\']').val(json['city']);
							$('#customer-saddress input[name=\'postcode\']').val(json['postcode']);
							$('#customer-saddress select[name=\'country_id\']').val(json['country_id']);
							shipping_zone_id = json['zone_id'];
							for (i in json['custom_field']) {
								$('#customer-saddress select[name=\'custom_field[' + i + ']\']').val(json['custom_field'][i]);
								$('#customer-saddress textarea[name=\'custom_field[' + i + ']\']').val(json['custom_field'][i]);
								$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'text\']').val(json['custom_field'][i]);
								$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'hidden\']').val(json['custom_field'][i]);
								$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'radio\'][value=\'' + json['custom_field'][i] + '\']').prop('checked', true);
								$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'checkbox\'][value=\'' + json['custom_field'][i] + '\']').prop('checked', true);
								if (json['custom_field'][i] instanceof Array) {
									for (j = 0; j < json['custom_field'][i].length; j++) {
										$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'checkbox\'][value=\'' + json['custom_field'][i][j] + '\']').prop('checked', true);
									}
								}
							}
							$('#customer-saddress select[name=\'country_id\']').trigger('change');
						}
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				if (!p_address_error) {
					setTimeout(function() {
						setPaymentAddress();
					}, 2000);
				}
			});
		});

		$('input[name=\'custom_price\']').on('click', function() {
			var checked = $(this).prop('checked');
			if (checked) {
				$('#input-price').removeAttr('disabled');
			} else {
				$('#input-price').attr('disabled', 'disabled');
			}
		});

		// Update payment address
		$('#button-payment-address').on('click', function() {
			var p_address_error = 0;
			$.ajax({
				url: '{{ catalog }}index.php?route=api/payment/address&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: $('#customer-address input[type=\'text\'], #customer-address input[type=\'hidden\'], #customer-address input[type=\'radio\']:checked, #customer-address input[type=\'checkbox\']:checked, #customer-address select, #customer-address textarea'),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						if (json['error']['warning']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						}
						for (i in json['error']) {
							var element = $('#input-payment-' + i.replace('_', '-'));
							if ($(element).parent().hasClass('input-group')) {
								$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
							} else {
								$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
							}
						}
						$('.text-danger').parentsUntil('.form-group').parent().addClass('has-error');
						{% if order_quote == 'order' %}
							p_address_error = 1;
							$('#close-customer-addr').hide();
							$('#close-customer-addr1').hide();
							$('#customer-address').show();
						{% endif %}
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				if (!p_address_error) {
					$('#close-customer-addr').show();
					$('#close-customer-addr1').show();
					var same_shipping = $('input[name=\'shipping_same_payment\']').prop('checked');
					if (same_shipping) {
						setShippingAddress1();
					} else {
						setShippingAddress2();
					}
				}
			});
		});

		// Shipping Address change
		$('select[name=\'shipping_address\']').on('change', function() {
			var s_address_error = 0;
			$.ajax({
				url: 'index.php?route=customer/customer/address&user_token={{ user_token }}&address_id=' + this.value,
				dataType: 'json',
				cache: false,
				beforeSend: function() {
					popgreyscreenwait();
				},
				success: function(json) {
					if (json['error']) {
						{% if order_quote == 'order' %}
							s_address_error = 1;
							$('#customer-saddress').show();
						{% endif %}
					} else {
						$('#customer-saddress input[name=\'firstname\']').val(json['firstname']);
						$('#customer-saddress input[name=\'lastname\']').val(json['lastname']);
						$('#customer-saddress input[name=\'company\']').val(json['company']);
						$('#customer-saddress input[name=\'address_1\']').val(json['address_1']);
						$('#customer-saddress input[name=\'address_2\']').val(json['address_2']);
						$('#customer-saddress input[name=\'city\']').val(json['city']);
						$('#customer-saddress input[name=\'postcode\']').val(json['postcode']);
						$('#customer-saddress select[name=\'country_id\']').val(json['country_id']);
						shipping_zone_id = json['zone_id'];
						for (i in json['custom_field']) {
							$('#customer-saddress select[name=\'custom_field[' + i + ']\']').val(json['custom_field'][i]);
							$('#customer-saddress textarea[name=\'custom_field[' + i + ']\']').val(json['custom_field'][i]);
							$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'text\']').val(json['custom_field'][i]);
							$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'hidden\']').val(json['custom_field'][i]);
							$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'radio\'][value=\'' + json['custom_field'][i] + '\']').prop('checked', true);
							$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'checkbox\'][value=\'' + json['custom_field'][i] + '\']').prop('checked', true);
							if (json['custom_field'][i] instanceof Array) {
								for (j = 0; j < json['custom_field'][i].length; j++) {
									$('#customer-saddress input[name^=\'custom_field[' + i + ']\'][type=\'checkbox\'][value=\'' + json['custom_field'][i][j] + '\']').prop('checked', true);
								}
							}
						}
						$('#customer-saddress select[name=\'country_id\']').trigger('change');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				if (!s_address_error) {
					setTimeout(function() {
						setShippingAddress2();
					}, 2000);
				}
			});
		});

		// Update shipping address
		$('#button-shipping-address').on('click', function() {
			var s_address_error = 0;
			$.ajax({
				url: '{{ catalog }}index.php?route=api/shipping/address&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: $('#customer-saddress input[type=\'text\'], #customer-saddress input[type=\'hidden\'], #customer-saddress input[type=\'radio\']:checked, #customer-saddress input[type=\'checkbox\']:checked, #customer-saddress select, #customer-saddress textarea'),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						if (json['error']['warning']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						}
						for (i in json['error']) {
							var element = $('#input-shipping-' + i.replace('_', '-'));
							if ($(element).parent().hasClass('input-group')) {
								$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
							} else {
								$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
							}
						}
						$('.text-danger').parentsUntil('.form-group').parent().addClass('has-error');
						{% if order_quote == 'order' %}
							s_address_error = 1;
							$('#close-customer-saddr').hide();
							$('#close-customer-saddr1').hide();
							$('#customer-saddress').show();
						{% endif %}
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				if (!s_address_error) {
					$('#close-customer-saddr').show();
					$('#close-customer-saddr1').show();
					getPaymentMethods();
				}
			});
		});

		$('#button-custom-shipping-apply').on('click', function() {
			popgreyscreenwait();
			$.ajax({
				url: '{{ catalog }}index.php?route=extension/api/order_entry/applyCustomShipping&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'POST',
				dataType: 'json',
				crossDomain: true,
				cache: false,
				data: 'title=' + encodeURIComponent($('input[name=\'custom_shipping_title\']').val()) + '&cost=' + $('input[name=\'custom_shipping_cost\']').val(),
				success: function(json) {
					html = '<option value="">{{ text_select }}</option>';
					if (json['shipping_methods']) {
						for (i in json['shipping_methods']) {
							html += '<optgroup label="' + json['shipping_methods'][i]['title'] + '">';
							if (!json['shipping_methods'][i]['error']) {
								for (j in json['shipping_methods'][i]['quote']) {
									if (json['shipping_methods'][i]['quote'][j]['code'] == $('select[name=\'shipping_method\'] option:selected').val()) {
										html += '<option value="' + json['shipping_methods'][i]['quote'][j]['code'] + '" selected="selected">' + json['shipping_methods'][i]['quote'][j]['title'] + ' - ' + json['shipping_methods'][i]['quote'][j]['text'] + '</option>';
									} else {
										html += '<option value="' + json['shipping_methods'][i]['quote'][j]['code'] + '">' + json['shipping_methods'][i]['quote'][j]['title'] + ' - ' + json['shipping_methods'][i]['quote'][j]['text'] + '</option>';
									}
								}
							} else {
								html += '<option value="" style="color: #F00;" disabled="disabled">' + json['shipping_methods'][i]['error'] + '</option>';
							}
							html += '</optgroup>';
						}
					}
					$('select[name=\'shipping_method\']').html(html);
					$.ajax({
						url: '{{ catalog }}index.php?route=api/shipping/method&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
						type: 'post',
						data: 'shipping_method=' + $('select[name=\'shipping_method\'] option:selected').val(),
						dataType: 'json',
						crossDomain: true,
						cache: false,
						beforeSend: function() {
							$('#input-shipping-method').attr('disabled', 'disabled');
						},
						complete: function() {
							$('#input-shipping-method').removeAttr('disabled');
						},
						success: function(json) {
							$('.alert, .alert-success, .alert-danger, .text-danger').remove();
							$('.form-group').removeClass('has-error');
							if (json['error']) {
								$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
								$('select[name=\'shipping_method\']').parent().parent().addClass('has-error');
								closegreyscreen();
							}
							if (json['success']) {
								$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
								$('#button-refresh').trigger('click');
							}
						},
						error: function(xhr, ajaxOptions, thrownError) {
							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
							closegreyscreen();
						}
					});
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		});

		// Add product popup functions
		$('#close-add-product1').on('click', function() {
			$('#close-add-product').trigger('click');
		});
		$('#close-add-product').on('click', function() {
			$('#add-product').hide();
			$('#add-product-error').hide();
			$('#add-product-error').html('');
			closegreyscreen();
		});
		$('#button-add-product').on('click', function() {
			if (customerValidate()) {
				$('#add-product').show();
				popgreyscreen();
			} else {
				alert('{{ text_customer_error}}');
				return false;
			}
		});

		// Add voucher popup functions
		$('#close-add-voucher1').on('click', function() {
			$('#close-add-voucher').trigger('click');
		});
		$('#close-add-voucher').on('click', function() {
			$('#add-voucher').hide();
			closegreyscreen();
		});
		$('#button-add-voucher').on('click', function() {
			$('#add-voucher').show();
			popgreyscreen();
		});

		// Product update functions
		var typingTimer;
		var doneTypingInterval = 900;
		$('#tab-cart').delegate('.btn-default', 'click', function() {
			popgreyscreenwait();
			var prow = $(this).val();
			var post_data = 'key=' + $('#quantity-' + prow).attr('rel');
			post_data += '&product_id=' + $('#product-' + prow).val();
			var shipping = 0;
			if ($('input[type=\'hidden\'][name=\'product[' + prow + '][shipping]').val() == 1) {
				shipping = 1;
			}
			post_data += '&name=' + encodeURIComponent($('#name-' + prow).val());
			post_data += '&model=' + encodeURIComponent($('#model-' + prow).val());
			post_data += '&price=' + $('#price-' + prow).val();
			post_data += '&quantity=' + $('#quantity-' + prow).val();
			post_data += '&image=' + encodeURIComponent($('#input-image-' + prow).val());
			post_data += '&sort_order=' + encodeURIComponent($('#sort-order-' + prow).val());
			post_data += '&shipping=' + shipping;
			var notax = 0;
			if ($('#notax-' + prow).is(':checked')) {
				notax = 1;
			}
			post_data += '&notax=' + notax;
			$.ajax({
				url: '{{ catalog }}index.php?route=api/cart/edit&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				dataType: 'json',
				data: post_data,
				crossDomain: true,
				cache: false,
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					if (json['error']) {
						if (json['error']['warning']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						}
						closegreyscreen();
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				if ($('#customer-saddress input[name=\'address_1\']').val() != '' && $('#customer-saddress input[name=\'city\']').val() != '') {
					var same_shipping = $('input[name=\'shipping_same_payment\']').prop('checked');
					if (same_shipping) {
						setShippingAddress1();
					} else {
						setShippingAddress2();
					}
				} else {
					$('#button-refresh').trigger('click');
				}
			});
		});

		// Add all products to the cart using the api
		$('#button-refresh').on('click', function() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/cart/products&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					if (json['error']) {
						if (json['error']['warning']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						}
						if (json['error']['stock']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['stock'] + '</div>');
						}
						if (json['error']['minimum']) {
							for (i in json['error']['minimum']) {
								$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['minimum'][i] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
							}
						}
						closegreyscreen();
					}
					var shipping = false;
					html = '';
					var p_columns = 5;
					{% if product_column_image %}
						p_columns++;
					{% endif %}
					{% if product_column_option %}
						p_columns++;
					{% endif %}
					{% if product_column_price %}
						p_columns++;
					{% endif %}
					{% if product_column_total %}
						p_columns++;
					{% endif %}
					{% if product_column_pricet %}
						p_columns++;
					{% endif %}
					{% if product_column_totalt %}
						p_columns++;
					{% endif %}
					{% if product_column_cost %}
						p_columns++;
					{% endif %}
					{% if product_column_notax %}
						p_columns++;
					{% endif %}
					var total_products = 0;
					if (json['products'].length) {
						total_products += json['products'].length;
						for (i = 0; i < json['products'].length; i++) {
							product = json['products'][i];
							html += '<tr>';
							{% if product_column_image %}
								html += '  <td class="text-center"><a id="thumb-image' + i + '" data-toggle="image" class="img-thumbnail"><img src="' + product['thumb'] + '" alt="" title="" data-placeholder="{{ placeholder }}" /></a><input type="hidden" name="product[' + i + '][image]" value="' + product['image'] + '" id="input-image-' + i + '" /></td>';
							{% endif %}
							html += '  <td class="text-left"><input id="name-' + i + '" type="text" name="product[' + i + '][name]" value="' + product['name'] + '" class="form-control" />';
							{% if not module_order_entry_allow_zero_qty %}
								if (!product['stock']) {
									html += '<span class="text-danger">***</span>';
								}
							{% endif %}
							html += '  <input id="product-' + i + '" type="hidden" name="product[' + i + '][product_id]" value="' + product['product_id'] + '" />';
							html += '  </td>';
							{% if product_column_option %}
								html += '  <td class="text-left">';
								if (product['option']) {
									for (j = 0; j < product['option'].length; j++) {
										option = product['option'][j];
										html += '  - <small>' + option['name'] + ': ' + option['value'] + '</small><br />';
										if (option['type'] == 'select' || option['type'] == 'radio' || option['type'] == 'image') {
											html += '<input type="hidden" name="product[' + i + '][option][' + option['product_option_id'] + ']" value="' + option['product_option_value_id'] + '" />';
										}
										if (option['type'] == 'checkbox') {
											html += '<input type="hidden" name="product[' + i + '][option][' + option['product_option_id'] + '][]" value="' + option['product_option_value_id'] + '" />';
										}
										if (option['type'] == 'text' || option['type'] == 'textarea' || option['type'] == 'file' || option['type'] == 'date' || option['type'] == 'datetime' || option['type'] == 'time') {
											html += '<input type="hidden" name="product[' + i + '][option][' + option['product_option_id'] + ']" value="' + option['value'] + '" />';
										}
									}
								}
								html += '</td>';
							{% else %}
								if (product['option']) {
									for (j = 0; j < product['option'].length; j++) {
										option = product['option'][j];
										if (option['type'] == 'select' || option['type'] == 'radio' || option['type'] == 'image') {
											html += '<input type="hidden" name="product[' + i + '][option][' + option['product_option_id'] + ']" value="' + option['product_option_value_id'] + '" />';
										}
										if (option['type'] == 'checkbox') {
											html += '<input type="hidden" name="product[' + i + '][option][' + option['product_option_id'] + '][]" value="' + option['product_option_value_id'] + '" />';
										}
										if (option['type'] == 'text' || option['type'] == 'textarea' || option['type'] == 'file' || option['type'] == 'date' || option['type'] == 'datetime' || option['type'] == 'time') {
											html += '<input type="hidden" name="product[' + i + '][option][' + option['product_option_id'] + ']" value="' + option['value'] + '" />';
										}
									}
								}
							{% endif %}
							html += '  <td class="text-left"><input id="model-' + i + '" type="text" name="product[' + i + '][model]" value="' + product['model'] + '" class="form-control" /></td>';
							html += '  <td class="text-right"><input id="quantity-' + i + '" rel="' + product['cart_id'] + '" style="text-align:right;" type="text" name="product[' + i + '][quantity]" value="' + product['quantity'] + '" class="form-control" style="width:50px !important;" /></td>';
							{% if product_column_price %}
								html += '  <td class="text-right"><input id="price-' + i + '" style="text-align:right;" type="text" name="product[' + i + '][price]" value="' + product['price'] + '" class="form-control" /></td>';
							{% else %}
								html += '  <input id="price-' + i + '" type="hidden" name="product[' + i + '][price]" value="' + product['price'] + '" />';
							{% endif %}
							{% if product_column_total %}
								html += '  <td class="text-right">' + product['total'] + '</td>';
							{% endif %}
							{% if product_column_cost %}
								html += '  <td class="text-right">' + product['cost'] + '</td>';
							{% endif %}
							{% if product_column_notax %}
								html += '  <td class="text-center">';
								if (product['notax'] == 1) {
									html += '    <input id="notax-' + i + '" type="checkbox" name="product[' + i + '][notax]" value="1" checked="checked" />';
								} else {
									html += '    <input id="notax-' + i + '" type="checkbox" name="product[' + i + '][notax]" value="1" />';
								}
								html += '  </td>';
							{% else %}
								html += '  <input id="notax-' + i + '" type="hidden" name="product[' + i + '][notax]" value="' + product['notax'] + '" />';
							{% endif %}
							{% if product_column_pricet %}
								html += '  <td class="text-right">' + product['price_t'] + '</td>';
							{% endif %}
							{% if product_column_totalt %}
								html += '  <td class="text-right">' + product['total_t'] + '</td>';
							{% endif %}
							html += '  <td class="text-left"><input id="sort-order-' + i + '" type="text" name="product[' + i + '][sort_order]" value="' + product['sort_order'] + '" class="form-control" style="width:50px !important;" /></td>';
							html += '  <td class="text-center" style="width:100px;"><button style="margin-right:5px;" type="button" value="' + i + '" data-toggle="tooltip" title="{{ button_update }}" data-loading-text="{{ text_loading }}" class="btn btn-default"><i class="fa fa-refresh"></i></button><button type="button" value="' + i + '" data-toggle="tooltip" title="{{ button_remove }}" data-loading-text="{{ text_loading }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
							html += '</tr>';
							if (product['shipping'] != 0) {
								shipping = true;
							}
						}
					}
					if (!shipping) {
						$('#total-form input[name=\'shipping_required\']').val('0');
						$('select[name=\'shipping_method\'] option').removeAttr('selected');
						$('select[name=\'shipping_method\']').prop('disabled', true);
					} else {
						$('#total-form input[name=\'shipping_required\']').val('1');
						$('select[name=\'shipping_method\']').prop('disabled', false);
					}
					if (json['vouchers'].length) {
						total_products += json['vouchers'].length;
						for (i in json['vouchers']) {
							voucher = json['vouchers'][i];
							html += '<tr>';
							{% if product_column_image %}
								html += '  <td class="text-center"></td>';
							{% endif %}
							html += '  <td class="text-left">' + voucher['description'];
							html += '    <input type="hidden" name="voucher[' + i + '][code]" value="' + voucher['code'] + '" />';
							html += '    <input type="hidden" name="voucher[' + i + '][description]" value="' + voucher['description'] + '" />';
							html += '    <input type="hidden" name="voucher[' + i + '][from_name]" value="' + voucher['from_name'] + '" />';
							html += '    <input type="hidden" name="voucher[' + i + '][from_email]" value="' + voucher['from_email'] + '" />';
							html += '    <input type="hidden" name="voucher[' + i + '][to_name]" value="' + voucher['to_name'] + '" />';
							html += '    <input type="hidden" name="voucher[' + i + '][to_email]" value="' + voucher['to_email'] + '" />';
							html += '    <input type="hidden" name="voucher[' + i + '][voucher_theme_id]" value="' + voucher['voucher_theme_id'] + '" />';
							html += '    <input type="hidden" name="voucher[' + i + '][message]" value="' + voucher['message'] + '" />';
							html += '    <input type="hidden" name="voucher[' + i + '][amount]" value="' + voucher['amount'] + '" />';
							html += '  </td>';
							{% if product_column_option %}
								html += '  <td class="text-left"></td>';
							{% endif %}
							html += '  <td class="text-left"></td>';
							html += '  <td class="text-right">1</td>';
							{% if product_column_price %}
								html += '  <td class="text-right">' + voucher['amount'] + '</td>';
							{% endif %}
							{% if product_column_total %}
								html += '  <td class="text-center"></td>';
							{% endif %}
							{% if product_column_cost %}
								html += '  <td class="text-right"></td>';
							{% endif %}
							{% if product_column_notax %}
								html += '  <td class="text-center"></td>';
							{% endif %}
							{% if product_column_pricet %}
								html += '  <td class="text-right">' + voucher['amount'] + '</td>';
							{% endif %}
							{% if product_column_totalt %}
								html += '  <td class="text-right">' + voucher['amount'] + '</td>';
							{% endif %}
							html += '  <td class="text-center"></td>';
							html += '  <td class="text-center" style="width: 3px;"><button type="button" value="' + voucher['code'] + '" data-toggle="tooltip" title="{{ button_remove }}" data-loading-text="{{ text_loading }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
							html += '</tr>';
						}
					}
					if (!json['products'].length && !json['vouchers'].length) {
						html += '<tr>';
						html += '  <td colspan="' + p_columns + '" class="text-center">{{ text_no_results }}</td>';
						html += '</tr>';
					}
					$('#total-form input[name=\'total_products\']').val(total_products);
					$('#cart').html(html);
					// Totals
					html = '';
					if (json['totals'].length) {
						for (i in json['totals']) {
							total = json['totals'][i];
							html += '<tr>';
							html += '  <td class="text-right" colspan="5"><b>' + total['title'] + ':</b></td>';
							if (total['color']) {
								html += '  <td class="text-right" style="color:' + total['color'] + ';">' + total['text'] + '</td>';
							} else {
								html += '  <td class="text-right">' + total['text'] + '</td>';
							}
							html += '</tr>';
						}
					}
					if (!json['totals'].length) {
						html += '<tr>';
						html += '  <td colspan="6" class="text-center">{{ text_no_results }}</td>';
						html += '</tr>';
					}
					$('#total').html(html);
					$('input[name=\'order_balance\']').val(json['balance']);
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				closegreyscreen();
			});
		});

		// Customer autocomplete
		$('input[name=\'customer\']').autocomplete({
			'source': function(request, response) {
				$.ajax({
					url: 'index.php?route=extension/sale/order_entry/customerautocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
					dataType: 'json',
					cache: false,
					success: function(json) {
						json.unshift({
							customer_id: '0',
							customer_group_id: '{{ customer_group_id}}',
							name: '{{ text_none}}',
							customer_group: '',
							firstname: '',
							lastname: '',
							email: '',
							telephone: '',
							reward_points: 0,
							custom_field: [],
							address: []
						});
						response($.map(json, function(item) {
							return {
								category: item['customer_group'],
								label: item['name'] + ', ' + item['email'],
								value: item['customer_id'],
								customer_group_id: item['customer_group_id'],
								firstname: item['firstname'],
								lastname: item['lastname'],
								email: item['email'],
								telephone: item['telephone'],
								reward_points: item['reward_points'],
								custom_field: item['custom_field'],
								address: item['address']
							}
						}));
					}
				});
			},
			'select': function(item) {
				$('#label-reward').html('{{ entry_reward }}<br/><small>' + item['reward_points'] + '</small>');
				$('#customer-information input[name=\'customer\']').val(item['label']);
				$('#customer-information select[name=\'customer_group_id\']').val(item['customer_group_id']);
				$('#customer-information input[name=\'customer_id\']').val(item['value']);
				$('#customer-information input[name=\'firstname\']').val(item['firstname']);
				$('#customer-information input[name=\'lastname\']').val(item['lastname']);
				$('#customer-information input[name=\'email\']').val(item['email']);
				$('#customer-information input[name=\'telephone\']').val(item['telephone']);
				for (i in item.custom_field) {
					$('#customer-information select[name=\'custom_field[' + i + ']\']').val(item.custom_field[i]);
					$('#customer-information textarea[name=\'custom_field[' + i + ']\']').val(item.custom_field[i]);
					$('#customer-information input[name^=\'custom_field[' + i + ']\'][type=\'text\']').val(item.custom_field[i]);
					$('#customer-information input[name^=\'custom_field[' + i + ']\'][type=\'hidden\']').val(item.custom_field[i]);
					$('#customer-information input[name^=\'custom_field[' + i + ']\'][type=\'radio\'][value=\'' + item.custom_field[i] + '\']').prop('checked', true);
					if (item.custom_field[i] instanceof Array) {
						for (j = 0; j < item.custom_field[i].length; j++) {
							$('#customer-information input[name^=\'custom_field[' + i + ']\'][type=\'checkbox\'][value=\'' + item.custom_field[i][j] + '\']').prop('checked', true);
						}
					}
				}
				if (item['value'] > 0) {
					$('#new-customer').hide();
					$('#new-customer input[name=\'save_customer\']').attr('checked', false);
					$('#new-customer input[name=\'notify_customer\']').attr('checked', false);
				} else {
					$('#new-customer').show();
				}
				var addresses = 0;
				html = '<option value="0">{{ text_none }}</option>';
				for (i in item['address']) {
					addresses++;
					if (item['address'][i]['city'] != '') {
						html += '<option value="' + item['address'][i]['address_id'] + '">' + item['address'][i]['firstname'] + ' ' + item['address'][i]['lastname'] + ', ' + item['address'][i]['address_1'] + ', ' + item['address'][i]['city'] + ', ' + item['address'][i]['country'] + '</option>';
					} else {
						html += '<option value="' + item['address'][i]['address_id'] + '">' + item['address'][i]['firstname'] + ' ' + item['address'][i]['lastname'] + ', ' + item['address'][i]['address_1'] + ', ' + item['address'][i]['country'] + '</option>';
					}
				}
				if (addresses) {
					$('select[name=\'payment_address\']').html(html);
					$('select[name=\'shipping_address\']').html(html);
					$('#payment-address').show();
					var same_shipping = $('input[name=\'shipping_same_payment\']').attr('checked');
					if (same_shipping) {
						$('#shipping-address').hide();
					} else {
						$('#shipping-address').show();
					}
				}
			}
		});

		// Product autocomplete
		$('#tab-product input[name=\'product\']').autocomplete({
			'source': function(request, response) {
				$.ajax({
					url: 'index.php?route=extension/sale/order_entry/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request) + '&store_id=' + $('input[name=\'store_id\']').val() + '&customer_group_id=' + $('#customer-information select[name=\'customer_group_id\'] option:selected').val(),
					dataType: 'json',
					cache: false,
					success: function(json) {
						response($.map(json, function(item) {
							return {
								label: item['name'],
								value: item['product_id'],
								model: item['model'],
								option: item['option'],
								price: item['price']
							}
						}));
					}
				});
			},
			'select': function(item) {
				$('#tab-product input[name=\'product\']').val(item['label']);
				$('#tab-product input[name=\'product_id\']').val(item['value']);
				if (item['option'] != '') {
					html  = '<fieldset>';
					for (i = 0; i < item['option'].length; i++) {
						option = item['option'][i];
						if (option['type'] == 'color') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '<label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
							html += '<div class="col-sm-10">';
							html += '<select name="option[' + option['product_option_id'] + ']" id="input-option' + option['product_option_id'] + '" class="form-control">';
							html += '<option value="">{{ text_select}}</option>';
							for (j = 0; j < option['product_option_value'].length; j++) {
								option_value = option['product_option_value'][j];
								html += '<option value="' + option_value['product_option_value_id'] + '">' + option_value['name'];
								if (option_value['price']) {
									html += ' (' + option_value['price_prefix'] + option_value['price'] + ')';
								}
								html += '</option>';
							}
							html += '</select>';
							html += '</div>';
							html += '</div>';
						}
						if (option['type'] == 'select') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
							html += '  <div class="col-sm-10">';
							html += '    <select name="option[' + option['product_option_id'] + ']" id="input-option' + option['product_option_id'] + '" class="form-control">';
							html += '      <option value="">{{ text_select}}</option>';
							for (j = 0; j < option['product_option_value'].length; j++) {
								option_value = option['product_option_value'][j];
								html += '<option value="' + option_value['product_option_value_id'] + '">' + option_value['name'];
								if (option_value['price']) {
									html += ' (' + option_value['price_prefix'] + option_value['price'] + ')';
								}
								html += '</option>';
							}
							html += '    </select>';
							html += '  </div>';
							html += '</div>';
						}
						if (option['type'] == 'multiple') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '<label class="col-sm-2 control-label">' + option['name'] + '</label>';
							html += '<div class="col-sm-10">';
							html += '<table class="table table-bordered table-hover">';
							html += '<tr style="background: #dddddd; line-height: 20px; font-weight: bold;">';
							html += '<td>{{ entry_quantity}}</td>';
							html += '<td>{{ text_image}}</td>';
							html += '<td>' + option['name'] + '</td>';
							html += '<td>{{ text_price}}</td>';
							html += '</tr>';
							for (j = 0; j < option['product_option_value'].length; j++) {
								option_value = option['product_option_value'][j];
								html += '<tr style="background: #eeeeee;">';
								html += '<td style="vertical-align:middle"><input type="text" name="oquantity[' + option['product_option_id'] + '][' + option_value['product_option_value_id'] + ']" style="width:50px !important;" value="0" /></td>';
								html += '<td style="vertical-align:middle">';
								if (option_value['image']) {
									html += '<img src="' + option_value['image'] + '" />';
								}
								html += '</td>';
								html += '<td style="vertical-align:middle">' + option_value['name'] + '</td>';
								html += '<td style="vertical-align:middle">' + option_value['total_price'] + '</td>';
								html += '</tr>';
							}
							html += '</table>';
							html += '</div>';
							html += '</div>';
						}
						if (option['type'] == 'radio') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
							html += '  <div class="col-sm-10">';
							html += '    <select name="option[' + option['product_option_id'] + ']" id="input-option' + option['product_option_id'] + '" class="form-control">';
							html += '      <option value="">{{ text_select}}</option>';
							for (j = 0; j < option['product_option_value'].length; j++) {
								option_value = option['product_option_value'][j];
								html += '<option value="' + option_value['product_option_value_id'] + '">' + option_value['name'];
								if (option_value['price']) {
									html += ' (' + option_value['price_prefix'] + option_value['price'] + ')';
								}
								html += '</option>';
							}
							html += '    </select>';
							html += '  </div>';
							html += '</div>';
						}
						if (option['type'] == 'checkbox') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label">' + option['name'] + '</label>';
							html += '  <div class="col-sm-10">';
							html += '    <div id="input-option' + option['product_option_id'] + '">';
							for (j = 0; j < option['product_option_value'].length; j++) {
								option_value = option['product_option_value'][j];
								html += '<div class="checkbox">';
								html += '  <label><input type="checkbox" name="option[' + option['product_option_id'] + '][]" value="' + option_value['product_option_value_id'] + '" /> ' + option_value['name'];
								if (option_value['price']) {
									html += ' (' + option_value['price_prefix'] + option_value['price'] + ')';
								}
								html += '  </label>';
								html += '</div>';
							}
							html += '    </div>';
							html += '  </div>';
							html += '</div>';
						}
						if (option['type'] == 'image') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
							html += '  <div class="col-sm-10">';
							html += '    <select name="option[' + option['product_option_id'] + ']" id="input-option' + option['product_option_id'] + '" class="form-control">';
							html += '      <option value="">{{ text_select}}</option>';
							for (j = 0; j < option['product_option_value'].length; j++) {
								option_value = option['product_option_value'][j];
								html += '<option value="' + option_value['product_option_value_id'] + '">' + option_value['name'];
								if (option_value['price']) {
									html += ' (' + option_value['price_prefix'] + option_value['price'] + ')';
								}
								html += '</option>';
							}
							html += '    </select>';
							html += '  </div>';
							html += '</div>';
						}
						if (option['type'] == 'text') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
							html += '  <div class="col-sm-10"><input type="text" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" id="input-option' + option['product_option_id'] + '" class="form-control" /></div>';
							html += '</div>';
						}
						if (option['type'] == 'textarea') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
							html += '  <div class="col-sm-10"><textarea name="option[' + option['product_option_id'] + ']" rows="5" id="input-option' + option['product_option_id'] + '" class="form-control">' + option['value'] + '</textarea></div>';
							html += '</div>';
						}
						if (option['type'] == 'file') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label">' + option['name'] + '</label>';
							html += '  <div class="col-sm-10">';
							html += '    <button type="button" id="button-upload' + option['product_option_id'] + '" data-loading-text="{{ text_loading}}" class="btn btn-default"><i class="fa fa-upload"></i> {{ button_upload}}</button>';
							html += '    <input type="hidden" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" id="input-option' + option['product_option_id'] + '" />';
							html += '  </div>';
							html += '</div>';
						}
						if (option['type'] == 'date') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
							html += '  <div class="col-sm-3"><div class="input-group date"><input type="text" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" placeholder="' + option['name'] + '" data-date-format="YYYY-MM-DD" id="input-option' + option['product_option_id'] + '" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></div>';
							html += '</div>';
						}
						if (option['type'] == 'datetime') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
							html += '  <div class="col-sm-3"><div class="input-group datetime"><input type="text" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" placeholder="' + option['name'] + '" data-date-format="YYYY-MM-DD HH:mm" id="input-option' + option['product_option_id'] + '" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></div>';
							html += '</div>';
						}
						if (option['type'] == 'time') {
							html += '<div class="form-group' + (option['required'] ? ' required' : '') + '">';
							html += '  <label class="col-sm-2 control-label" for="input-option' + option['product_option_id'] + '">' + option['name'] + '</label>';
							html += '  <div class="col-sm-3"><div class="input-group time"><input type="text" name="option[' + option['product_option_id'] + ']" value="' + option['value'] + '" placeholder="' + option['name'] + '" data-date-format="HH:mm" id="input-option' + option['product_option_id'] + '" class="form-control" /><span class="input-group-btn"><button type="button" class="btn btn-default"><i class="fa fa-calendar"></i></button></span></div></div>';
							html += '</div>';
						}
					}
					html += '</fieldset>';
					$('#add-product').hide();
					$('#option-box').show();
					$('#option').html(html);
					$('.date').datetimepicker({
						pickTime: false
					});
					$('.datetime').datetimepicker({
						pickDate: true,
						pickTime: true
					});
					$('.time').datetimepicker({
						pickDate: false
					});
				} else {
					$('#option-box').hide();
					$('#option').html('');
				}
			}
		});
		$('#button-save-option').on('click', function() {
			$('.alert, .alert-success, .alert-danger, .text-danger').remove();
			$('.form-group').removeClass('has-error');
			$('#option-box').hide();
			$('#add-product').show();
		});
		$('#button-close-option').on('click', function() {
			$('.alert, .alert-success, .alert-danger, .text-danger').remove();
			$('.form-gorup').removeClass('has-error');
			$('#option-box').hide();
			$('#add-product').show();
		});
		// Add multiple products to order
		$('#button-product-add-more').on('click', function() {
			var add_error = 0;
			if ($('#tab-product input[name=\'product_id\']').val() > 0) {
				$.ajax({
					url: '{{ catalog }}index.php?route=api/cart/add&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
					type: 'post',
					data: $('#tab-product input[name=\'product_id\'], #tab-product input[name=\'quantity\'], #tab-product input[name=\'price\'], #tab-product input[name=\'notax\'][type=\'checkbox\']:checked, #tab-product input[name=\'custom_price\'][type=\'checkbox\']:checked, #option input[name^=\'option\'][type=\'text\'], #option input[name^=\'option\'][type=\'hidden\'], #option input[name^=\'option\'][type=\'radio\']:checked, #option input[name^=\'option\'][type=\'checkbox\']:checked, #option select[name^=\'option\'], #option textarea[name^=\'option\'], #option input[name^=\'oquantity\'][type=\'text\']'),
					dataType: 'json',
					crossDomain: true,
					cache: false,
					beforeSend: function() {
						$('#button-product-add-close').button('loading');
						$('#button-product-add-more').button('loading');
					},
					complete: function() {
						$('#button-product-add-close').button('reset');
						$('#button-product-add-more').button('reset');
					},
					success: function(json) {
						$('.alert, .alert-success, .alert-danger, .text-danger').remove();
						$('.form-group').removeClass('has-error');
						if (json['error']) {
							add_error = 1;
							if (json['error']['warning']) {
								$('#add-product-error').html('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
								$('#add-product-error').show();
							}
							if (json['error']['option']) {
								for (i in json['error']['option']) {
									var element = $('#input-option' + i.replace('_', '-'));
									if (element.parent().hasClass('input-group')) {
										$(element).parent().after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
									} else {
										$(element).after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
									}
									$('#tab-product').prepend('<div class="text-danger">' + json['error']['option'][i] + '</div>');
								}
								$('#add-product').hide();
								$('#option-box').show();
							}
							if (json['error']['store']) {
								$('#add-product-error').html('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['store'] + '</div>');
								$('#add-product-error').show();
							}
						} else {
							$('#option-box').hide();
							$('input[name=\'product_id\']').val('');
							$('input[name=\'product\']').val('');
							$('input[name=\'quantity\']').val('1');
							$('input[name=\'price\']').val('');
							$('input[name=\'notax\']').attr('checked', false);
							$('input[name=\'custom_price\']').attr('checked', false);
							$('input[name=\'price\']').attr('disabled', 'disabled');
							$('#option').html('');
						}
					},
					error: function(xhr, ajaxOptions, thrownError) {
						alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					}
				});
			} else {
				alert('{{ text_product_error }}');
				return false;
			}
		});
		// Add a product to order
		$('#button-product-add-close').on('click', function() {
			var add_error = 0;
			if ($('#tab-product input[name=\'product_id\']').val() > 0) {
				$.ajax({
					url: '{{ catalog }}index.php?route=api/cart/add&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
					type: 'post',
					data: $('#tab-product input[name=\'product_id\'], #tab-product input[name=\'quantity\'], #tab-product input[name=\'price\'], #tab-product input[name=\'notax\'][type=\'checkbox\']:checked, #tab-product input[name=\'custom_price\'][type=\'checkbox\']:checked, #option input[name^=\'option\'][type=\'text\'], #option input[name^=\'option\'][type=\'hidden\'], #option input[name^=\'option\'][type=\'radio\']:checked, #option input[name^=\'option\'][type=\'checkbox\']:checked, #option select[name^=\'option\'], #option textarea[name^=\'option\'], #option input[name^=\'oquantity\'][type=\'text\']'),
					dataType: 'json',
					crossDomain: true,
					cache: false,
					beforeSend: function() {
						$('#button-product-add-close').button('loading');
						$('#button-product-add-more').button('loading');
					},
					complete: function() {
						$('#button-product-add-close').button('reset');
						$('#button-product-add-more').button('reset');
						if (add_error == 0) {
							popgreyscreenwait();
						}
					},
					success: function(json) {
						$('.alert, .alert-success, .alert-danger, .text-danger').remove();
						$('.form-group').removeClass('has-error');
						if (json['error']) {
							add_error = 1;
							if (json['error']['warning']) {
								$('#add-product-error').html('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
								$('#add-product-error').show();
							}
							if (json['error']['option']) {
								for (i in json['error']['option']) {
									var element = $('#input-option' + i.replace('_', '-'));
									if (element.parent().hasClass('input-group')) {
										$(element).parent().after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
									} else {
										$(element).after('<div class="text-danger">' + json['error']['option'][i] + '</div>');
									}
									$('#tab-product').prepend('<div class="text-danger">' + json['error']['option'][i] + '</div>');
								}
								$('#add-product').hide();
								$('#option-box').show();
							}
							if (json['error']['store']) {
								$('#add-product-error').html('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['store'] + '</div>');
								$('#add-product-error').show();
							}
							closegreyscreen();
						} else {
							$('#option-box').hide();
							$('#close-add-product').trigger('click');
							$('input[name=\'product_id\']').val('');
							$('input[name=\'product\']').val('');
							$('input[name=\'quantity\']').val('1');
							$('input[name=\'price\']').val('');
							$('input[name=\'notax\']').attr('checked', false);
							$('input[name=\'custom_price\']').attr('checked', false);
							$('input[name=\'price\']').attr('disabled', 'disabled');
							$('#option').html('');
						}
					},
					error: function(xhr, ajaxOptions, thrownError) {
						alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						closegreyscreen();
					}
				}).done(function() {
					{% if not copy_order %}
						if (add_error == 0) {
							if ($('#total-form input[name=\'order_id\']').val() > 0) {
								setPaymentAddress();
							} else {
								var shipping_same = $('input[name=\'shipping_same_payment\']').prop('checked');
								if (shipping_same) {
									setShippingAddress1();
								} else {
									setShippingAddress2();
								}
							}
						}
					{% else %}
						if (add_error == 0) {
							setPaymentAddress();
						}
					{% endif %}
				});
			} else {
				alert('{{ text_product_error}}');
				return false;
			}
		});
		// Add a voucher to order
		$('#button-voucher-add').on('click', function() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/voucher/add&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: $('#tab-voucher input[type=\'text\'], #tab-voucher input[type=\'hidden\'], #tab-voucher input[type=\'radio\']:checked, #tab-voucher input[type=\'checkbox\']:checked, #tab-voucher select, #tab-voucher textarea'),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				beforeSend: function() {
					$('#button-voucher-add').button('loading');
				},
				complete: function() {
					$('#button-voucher-add').button('reset');
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						if (json['error']['warning']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						}
						for (i in json['error']) {
							var element = $('#input-' + i.replace('_', '-'));
							if (element.parent().hasClass('input-group')) {
								$(element).parent().after('<div class="text-danger">' + json['error'][i] + '</div>');
							} else {
								$(element).after('<div class="text-danger">' + json['error'][i] + '</div>');
							}
						}
						$('.text-danger').parentsUntil('.form-group').parent().addClass('has-error');
						closegreyscreen();
					} else {
						$('#button-refresh').trigger('click');
						$('input[name=\'from_name\']').attr('value', '');
						$('input[name=\'from_email\']').attr('value', '');
						$('input[name=\'to_name\']').attr('value', '');
						$('input[name=\'to_email\']').attr('value', '');
						$('textarea[name=\'message\']').attr('value', '');
						$('input[name=\'amount\']').val('{{ voucher_min|escape('js') }}');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		});

		// Remove product from order
		$('#cart').delegate('.btn-danger', 'click', function() {
			var node = this;
			var key = $('#quantity-' + $(this).val()).attr('rel');
			$.ajax({
				url: '{{ catalog }}index.php?route=api/cart/remove&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: 'key=' + encodeURIComponent(key),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				beforeSend: function() {
					$(node).button('loading');
				},
				complete: function() {
					$(node).button('reset');
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					if (json['error']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						closegreyscreen();
					} else {
						$('#button-refresh').trigger('click');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				{% if not copy_order and order_quote == 'order' %}
					if ($('#total-form input[name=\'order_id\']').val() > 0) {
						setPaymentAddress();
					} else {
						var shipping_same = $('input[name=\'shipping_same_payment\']').prop('checked');
						if (shipping_same) {
							setShippingAddress1();
						} else {
							setShippingAddress2();
						}
					}
				{% elseif copy_order %}
					setPaymentAddress();
				{% else %}
					$('#button-refresh').trigger('click');
				{% endif %}
			});
		});

		// Refresh products, vouchers, and totals
		$('#cart').delegate('.btn-primary', 'click', function() {
			var node = this;
			$.ajax({
				url: '{{ catalog }}index.php?route=api/cart/add&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: $('#cart input[name^=\'product\'][type=\'text\'], #cart input[name^=\'product\'][type=\'hidden\'], #cart input[name^=\'product\'][type=\'radio\']:checked, #cart input[name^=\'product\'][type=\'checkbox\']:checked, #cart select[name^=\'product\'], #cart textarea[name^=\'product\']'),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				beforeSend: function() {
					$(node).button('loading');
				},
				complete: function() {
					$(node).button('reset');
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error'] && json['error']['warning']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error']['warning'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
					}
					if (json['success']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				$('#button-refresh').trigger('click');
			});
		});

		function setLanguage() {
			$.ajax({
				url: '{{ catalog }}index.php?route=extension/api/order_entry/setLanguage&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'GET',
				dataType: 'json',
				crossDomain: true,
				cache: false,
				success: function(json) {
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		}
		function setTax() {
			var checked = $('input[name=\'no_tax\']').prop('checked');
			if (checked) {
				checked = 1;
			} else {
				checked = 0;
			}
			$.ajax({
				url: '{{ catalog }}index.php?route=extension/api/order_entry/setTax&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				dataType: 'json',
				data: 'no_tax=' + checked,
				cache: false,
				crossDomain: true,
				success: function(json) {
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		}

		$('#tab-total input[name=\'no_tax\']').on('click', function() {
			popgreyscreenwait();
			var checked = $('input[name=\'no_tax\']').prop('checked');
			if (checked) {
				checked = 1;
			} else {
				checked = 0;
			}
			$.ajax({
				url: '{{ catalog }}index.php?route=extension/api/order_entry/setTax&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				dataType: 'json',
				data: 'no_tax=' + checked,
				cache: false,
				crossDomain: true,
				success: function(json) {
					$('#button-refresh').trigger('click');
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		});

		// Set shipping method
		$('#input-shipping-method').on('change', function() {
			if ($('select[name=\'shipping_method\']').val() != '') {
				popgreyscreenwait();
				if ($('select[name=\'shipping_method\']').val() == 'oe_custom_shipping.oe_custom_shipping') {
					$.ajax({
						url: '{{ catalog }}index.php?route=extension/api/order_entry/getCustomShipping&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
						type: 'post',
						dataType: 'json',
						data: 'custom_shipping_title=' + $('#input-custom-shipping-title').val() + '&custom_shipping_cost=' + $('#input-custom-shipping-cost').val(),
						crossDomain: true,
						cache: false,
						success: function(json) {
							$('#input-custom-shipping-title').val(json['title']);
							$('#input-custom-shipping-cost').val(json['cost']);
							$('#custom-shipping').show();
							html = '<option value="">{{ text_select }}</option>';
							if (json['shipping_methods']) {
								for (i in json['shipping_methods']) {
									html += '<optgroup label="' + json['shipping_methods'][i]['title'] + '">';
									if (!json['shipping_methods'][i]['error']) {
										for (j in json['shipping_methods'][i]['quote']) {
											if (json['shipping_methods'][i]['quote'][j]['code'] == $('select[name=\'shipping_method\'] option:selected').val()) {
												html += '<option value="' + json['shipping_methods'][i]['quote'][j]['code'] + '" selected="selected">' + json['shipping_methods'][i]['quote'][j]['title'] + ' - ' + json['shipping_methods'][i]['quote'][j]['text'] + '</option>';
											} else {
												html += '<option value="' + json['shipping_methods'][i]['quote'][j]['code'] + '">' + json['shipping_methods'][i]['quote'][j]['title'] + ' - ' + json['shipping_methods'][i]['quote'][j]['text'] + '</option>';
											}
										}
									} else {
										html += '<option value="" style="color: #F00;" disabled="disabled">' + json['shipping_methods'][i]['error'] + '</option>';
									}
									html += '</optgroup>';
								}
							}
							$('select[name=\'shipping_method\']').html(html);
						},
						error: function(xhr, ajaxOptions, thrownError) {
							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
							closegreyscreen();
						}
					}).done(function() {
						$.ajax({
							url: '{{ catalog }}index.php?route=api/shipping/method&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
							type: 'post',
							data: 'shipping_method=' + $('select[name=\'shipping_method\'] option:selected').val(),
							dataType: 'json',
							crossDomain: true,
							cache: false,
							beforeSend: function() {
								$('#input-shipping-method').attr('disabled', 'disabled');
							},
							complete: function() {
								$('#input-shipping-method').removeAttr('disabled');
							},
							success: function(json) {
								$('.alert, .alert-success, .alert-danger, .text-danger').remove();
								$('.form-group').removeClass('has-error');
								if (json['error']) {
									$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
									$('select[name=\'shipping_method\']').parent().parent().addClass('has-error');
									closegreyscreen();
								}
								if (json['success']) {
									$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
									$('#button-refresh').trigger('click');
								}
							},
							error: function(xhr, ajaxOptions, thrownError) {
								alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
								closegreyscreen();
							}
						});
					});
				} else {
					$('#custom-shipping').hide();
					$('#input-custom-shipping-title').val('');
					$('#input-custom-shipping-cost').val('');
					$.ajax({
						url: '{{ catalog }}index.php?route=extension/api/order_entry/removeCustomShipping&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
						dataType: 'json',
						crossDomain: true,
						cache: false,
						success: function(json) {
							html = '<option value="">{{ text_select }}</option>';
							if (json['shipping_methods']) {
								for (i in json['shipping_methods']) {
									html += '<optgroup label="' + json['shipping_methods'][i]['title'] + '">';
									if (!json['shipping_methods'][i]['error']) {
										for (j in json['shipping_methods'][i]['quote']) {
											if (json['shipping_methods'][i]['quote'][j]['code'] == $('select[name=\'shipping_method\'] option:selected').val()) {
												html += '<option value="' + json['shipping_methods'][i]['quote'][j]['code'] + '" selected="selected">' + json['shipping_methods'][i]['quote'][j]['title'] + ' - ' + json['shipping_methods'][i]['quote'][j]['text'] + '</option>';
											} else {
												html += '<option value="' + json['shipping_methods'][i]['quote'][j]['code'] + '">' + json['shipping_methods'][i]['quote'][j]['title'] + ' - ' + json['shipping_methods'][i]['quote'][j]['text'] + '</option>';
											}
										}
									} else {
										html += '<option value="" style="color: #F00;" disabled="disabled">' + json['shipping_methods'][i]['error'] + '</option>';
									}
									html += '</optgroup>';
								}
							}
							$('select[name=\'shipping_method\']').html(html);
						},
						error: function(xhr, ajaxOptions, thrownError) {
							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
							closegreyscreen();
						}
					}).done(function() {
						$.ajax({
							url: '{{ catalog }}index.php?route=api/shipping/method&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
							type: 'post',
							data: 'shipping_method=' + $('select[name=\'shipping_method\'] option:selected').val(),
							dataType: 'json',
							crossDomain: true,
							cache: false,
							beforeSend: function() {
								$('#input-shipping-method').attr('disabled', 'disabled');
							},
							complete: function() {
								$('#input-shipping-method').removeAttr('disabled');
							},
							success: function(json) {
								$('.alert, .alert-success, .alert-danger, .text-danger').remove();
								$('.form-group').removeClass('has-error');
								if (json['error']) {
									$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
									$('select[name=\'shipping_method\']').parent().parent().addClass('has-error');
									closegreyscreen();
								}
								if (json['success']) {
									$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
									$('#button-refresh').trigger('click');
								}
							},
							error: function(xhr, ajaxOptions, thrownError) {
								alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
								closegreyscreen();
							}
						});
					});
				}
			} else {
				$('#button-refresh').trigger('click');
			}
		});

		// Set payment method
		$('#input-payment-method').on('change', function() {
			var cc_form = 0;
			popgreyscreenwait();
			$.ajax({
				url: '{{ catalog }}index.php?route=api/payment/method&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: 'payment_method=' + $('select[name=\'payment_method\'] option:selected').val(),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				beforeSend: function() {
					$('#input-payment-method').attr('disabled', 'disabled');
				},
				complete: function() {
					$('#input-payment-method').removeAttr('disabled');
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						$('select[name=\'payment_method\']').parent().parent().addClass('has-error');
						closegreyscreen();
					}
					if (json['success']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			}).done(function() {
				{% if not copy_order and order_quote == 'order' %}
					if ($('#total-form input[name=\'order_id\']').val() > 0) {
						getShippingMethods();
					} else {
						$('#button-refresh').trigger('click');
					}
				{% elseif copy_order %}
					getShippingMethods();
				{% else %}
					$('#button-refresh').trigger('click');
				{% endif %}
			});
		});

		// Coupon
		$('#input-coupon').on('keydown', function(e) {
			var keyCode = e.keyCode || e.which;
			if (keyCode != 9) {
				clearTimeout(typingTimer);
				if ($('#input-coupon').val) {
					typingTimer = setTimeout(processCoupon, doneTypingInterval);
				}
			}
		});
		function processCoupon() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/coupon&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: 'coupon=' + $('input[name=\'coupon\']').val(),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				beforeSend: function() {
					$('#input-coupon').attr('disabled', 'disabled');
				},
				complete: function() {
					$('#input-coupon').removeAttr('disabled');
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						$('input[name=\'coupon\']').parent().parent().addClass('has-error');
						closegreyscreen();
					}
					if (json['success']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						$('#button-refresh').trigger('click');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		}

		// Use voucher on order
		$('#input-voucher').on('keydown', function(e) {
			var keyCode = e.keyCode || e.which;
			if (keyCode != 9) {
				clearTimeout(typingTimer);
				if ($('#input-voucher').val) {
					typingTimer = setTimeout(processVoucher, doneTypingInterval);
				}
			}
		});
		function processVoucher() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/voucher&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: 'voucher=' + $('input[name=\'voucher\']').val(),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				beforeSend: function() {
					$('#input-voucher').attr('disabled', 'disabled');
				},
				complete: function() {
					$('#input-voucher').removeAttr('disabled');
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						$('input[name=\'voucher\']').parent().parent().addClass('has-error');
						closegreyscreen();
					}
					if (json['success']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						$('#button-refresh').trigger('click');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		}

		// Use reward points on order
		$('#input-reward').on('keydown', function(e) {
			var keyCode = e.keyCode || e.which;
			if (keyCode != 9) {
				clearTimeout(typingTimer);
				if ($('#input-reward').val) {
					typingTimer = setTimeout(processReward, doneTypingInterval);
				}
			}
		});
		function processReward() {
			$.ajax({
				url: '{{ catalog }}index.php?route=api/reward&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
				type: 'post',
				data: 'reward=' + $('input[name=\'reward\']').val(),
				dataType: 'json',
				crossDomain: true,
				cache: false,
				beforeSend: function() {
					$('#input-reward').attr('disabled', 'disabled');
				},
				complete: function() {
					$('#input-reward').removeAttr('disabled');
				},
				success: function(json) {
					$('.alert, .alert-success, .alert-danger, .text-danger').remove();
					$('.form-group').removeClass('has-error');
					if (json['error']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						$('input[name=\'reward\']').parent().parent().addClass('has-error');
						closegreyscreen();
					}
					if (json['success']) {
						$('#content > .container-fluid').prepend('<div class="alert alert-success"><i class="fa fa-check-circle"></i> ' + json['success'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
						$('#button-refresh').trigger('click');
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
					alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
					closegreyscreen();
				}
			});
		}

		// Affiliate
		$('input[name=\'affiliate\']').autocomplete({
			'source': function(request, response) {
				$.ajax({
					url: 'index.php?route=marketing/affiliate/autocomplete&user_token={{ user_token }}&filter_name=' +  encodeURIComponent(request),
					dataType: 'json',
					cache: false,
					success: function(json) {
						json.unshift({
							affiliate_id: 0,
							name: '{{ text_none}}'
						});
						response($.map(json, function(item) {
							return {
								label: item['name'],
								value: item['affiliate_id']
							}
						}));
					}
				});
			},
			'select': function(item) {
				$('input[name=\'affiliate\']').val(item['label']);
				$('input[name=\'affiliate_id\']').val(item['value']);
			}
		});

		// Save order
		$('#button-save1').on('click', function() {
			$('#button-save').trigger('click');
		});
		$('#button-save').on('click', function() {
			var checkorder = checkOrder();
			if (checkorder == 1) {
				popgreyscreenwait();
				{% if order_quote == 'order' %}
					var order_id = $('#total-form input[name=\'order_id\']').val();
					if (order_id == 0) {
						var url = '{{ catalog }}index.php?route=api/order/add&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val();
						$('#customer-information input[name=\'store\']').val($('select[name=\'store_id\']').val());
						$('#customer-information input[name=\'store_id\']').val($('select[name=\'store_id\']').val());
					} else {
						var url = '{{ catalog }}index.php?route=api/order/edit&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val() + '&order_id=' + order_id;
					}
					var save_customer = $('#new-customer input[name=\'save_customer\']').prop('checked');
					if (!save_customer) {
						$('#new-customer input[name=\'save_customer\']').val('0');
					}
					var notify_customer = $('#new-customer input[name=\'notify_customer\']').prop('checked');
					if (!notify_customer) {
						$('#new-customer input[name=\'notify_customer\']').val('0');
					}
				{% else %}
					var quote_id = $('input[name=\'quote_id\']').val();
					if (quote_id == 0) {
						var url = '{{ catalog }}index.php?route=extension/api/quote_system/add&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val();
						$('#customer-information input[name=\'store\']').val($('select[name=\'store_id\']').val());
						$('#customer-information input[name=\'store_id\']').val($('select[name=\'store_id\']').val());
					} else {
						var url = '{{ catalog }}index.php?route=extension/api/quote_system/edit&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val() + '&quote_id=' + quote_id;
					}
					var save_customer = $('#new-customer input[name=\'save_customer\']').prop('checked');
					if (!save_customer) {
						$('#new-customer input[name=\'save_customer\']').val('0');
					}
					var notify_customer = $('#new-customer input[name=\'notify_customer\']').prop('checked');
					if (!notify_customer) {
						$('#new-customer input[name=\'notify_customer\']').val('0');
					}
				{% endif %}
				$.ajax({
					url: url,
					type: 'post',
					data: $('#tab-total select[name=\'payment_method\'] option:selected,  #tab-total select[name=\'shipping_method\'] option:selected,  #tab-total input[type=\'checkbox\']:checked, #tab-total select[name=\'order_status_id\'], #tab-total select, #tab-total textarea[name=\'comment\'], #tab-total input[name=\'affiliate_id\'], #tab-total input[type=\'text\'], #new-customer input[type=\'checkbox\']:checked, #new-address input[type=\'checkbox\']:checked, #customer-information input[name=\'store\']'),
					dataType: 'json',
					crossDomain: true,
					cache: false,
					beforeSend: function() {
						$('#button-save').button('loading');
					},
					complete: function() {
						$('#button-save').button('reset');
					},
					success: function(json) {
						$('.alert, .alert-success, .alert-danger, .text-danger').remove();
						if (json['error']) {
							$('#content > .container-fluid').prepend('<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> ' + json['error'] + ' <button type="button" class="close" data-dismiss="alert">&times;</button></div>');
							$('html, body').animate({ scrollTop: 0 }, 'slow');
							$('#button-refresh').trigger('click');
						}
						if (json['success']) {
							$.ajax({
								url: '{{ catalog }}index.php?route=api/order/clearsession&api_token={{ api_token }}&store_id=' + $('input[name=\'store_id\']').val(),
								dataType: 'json',
								crossDomain: true,
								cache: false
							}).done(function() {
								var return_url = 'index.php?route=sale/order&user_token={{ user_token }}';
								{% if filter_order_id %}
									return_url += '&filter_order_id={{ filter_order_id }}';
								{% endif %}
								{% if filter_customer %}
									return_url += '&filter_customer={{ filter_customer }}';
								{% endif %}
								{% if filter_order_status %}
									return_url += '&filter_order_status={{ filter_order_status }}';
								{% endif %}
								{% if filter_total %}
									return_url += '&filter_total={{ filter_total }}';
								{% endif %}
								{% if filter_date_added %}
									return_url += '&filter_date_added={{ filter_date_added }}';
								{% endif %}
								{% if filter_date_modified %}
									return_url += '&filter_date_modified={{ filter_date_modified }}';
								{% endif %}
								{% if sort %}
									return_url += '&sort={{ sort }}';
								{% endif %}
								{% if sort_order %}
									return_url += '&order={{ sort_order }}';
								{% endif %}
								{% if page %}
									return_url += '&page={{ page }}';
								{% endif %}
								location.href = return_url;
							});
						}
					},
					error: function(xhr, ajaxOptions, thrownError) {
						alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
						closegreyscreen();
					}
				});
			} else {
				if (checkorder == -1) {
					alert('{{ error_customer }}');
					return false;
				} else if (checkorder == -2) {
					alert('{{ error_payment_address }}');
					return false;
				} else if (checkorder == -3) {
					alert('{{ error_shipping_address }}');
					return false;
				} else if (checkorder == -4) {
					alert('{{ error_product }}');
					return false;
				} else if (checkorder == -5) {
					alert('{{ error_shipping }}');
					return false;
				} else {
					alert('{{ error_payment }}');
					return false;
				}
			}
		});
		$('#content').delegate('button[id^=\'button-upload\'], button[id^=\'button-custom-field\'], button[id^=\'button-payment-custom-field\'], button[id^=\'button-shipping-custom-field\']', 'click', function() {
			var node = this;
			$('#form-upload').remove();
			$('body').prepend('<form enctype="multipart/form-data" id="form-upload" style="display: none;"><input type="file" name="file" /></form>');
			$('#form-upload input[name=\'file\']').trigger('click');
			if (typeof timer != 'undefined') {
				clearInterval(timer);
			}
			timer = setInterval(function() {
				if ($('#form-upload input[name=\'file\']').val() != '') {
					clearInterval(timer);
					$.ajax({
						url: 'index.php?route=tool/upload/upload&user_token={{ user_token }}',
						type: 'post',
						dataType: 'json',
						data: new FormData($('#form-upload')[0]),
						cache: false,
						contentType: false,
						processData: false,
						beforeSend: function() {
							$(node).button('loading');
						},
						complete: function() {
							$(node).button('reset');
						},
						success: function(json) {
							$(node).parent().find('.text-danger').remove();
							if (json['error']) {
								$(node).parent().find('input[type=\'hidden\']').after('<div class="text-danger">' + json['error'] + '</div>');
								closegreyscreen();
							}
							if (json['success']) {
								alert(json['success']);
							}
							if (json['code']) {
								$(node).parent().find('input[type=\'hidden\']').attr('value', json['code']);
							}
						},
						error: function(xhr, ajaxOptions, thrownError) {
							alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
							closegreyscreen();
						}
					});
				}
			}, 500);
		});
		$('.date').datetimepicker({
			pickTime: false
		});
		$('.datetime').datetimepicker({
			pickDate: true,
			pickTime: true
		});
		$('.time').datetimepicker({
			pickDate: false
		});
		$(document).ready(function() {
			if ($('input[name=\'customer_id\']').val() > 0) {
				$('#add-customer').hide();
			}
		});
	//--></script>
	<script type="text/javascript">
		// Sort the custom fields
		$('#customer-information .form-group[data-sort]').detach().each(function() {
			if ($(this).attr('data-sort') >= 0 && $(this).attr('data-sort') <= $('#customer-information .form-group').length) {
				$('#customer-information .form-group').eq($(this).attr('data-sort')).before(this);
			}
			if ($(this).attr('data-sort') > $('#customer-information .form-group').length) {
				$('#customer-information .form-group:last').after(this);
			}
			if ($(this).attr('data-sort') < -$('#customer-information .form-group').length) {
				$('#customer-information .form-group:first').before(this);
			}
		});
		// Sort the custom fields
		$('#customer-address .form-group[data-sort]').detach().each(function() {
			if ($(this).attr('data-sort') >= 0 && $(this).attr('data-sort') <= $('#customer-address .form-group').length) {
				$('#customer-address .form-group').eq($(this).attr('data-sort')).before(this);
			}
			if ($(this).attr('data-sort') > $('#customer-address .form-group').length) {
				$('#customer-address .form-group:last').after(this);
			}
			if ($(this).attr('data-sort') < -$('#customer-address .form-group').length) {
				$('#customer-address .form-group:first').before(this);
			}
		});
		$('#customer-saddress .form-group[data-sort]').detach().each(function() {
			if ($(this).attr('data-sort') >= 0 && $(this).attr('data-sort') <= $('#customer-saddress .form-group').length) {
				$('#customer-saddress .form-group').eq($(this).attr('data-sort')).before(this);
			}
			if ($(this).attr('data-sort') > $('#customer-saddress .form-group').length) {
				$('#customer-saddress .form-group:last').after(this);
			}
			if ($(this).attr('data-sort') < -$('#customer-saddress .form-group').length) {
				$('#customer-saddress .form-group:first').before(this);
			}
		});
	</script>
</div>
{{ footer }}